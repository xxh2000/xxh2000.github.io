"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5300],{1692:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>a});var t=i(4848),s=i(8453);const r={custom_edit_url:null},d=void 0,l={id:"Flink/Flink\u5b9e\u8df5",title:"Flink\u5b9e\u8df5",description:"Flink SQL \u7a97\u53e3",source:"@site/docs/Flink/Flink\u5b9e\u8df5.md",sourceDirName:"Flink",slug:"/Flink/Flink\u5b9e\u8df5",permalink:"/docs/Flink/Flink\u5b9e\u8df5",draft:!1,unlisted:!1,editUrl:null,tags:[],version:"current",frontMatter:{custom_edit_url:null},sidebar:"tutorialSidebar",previous:{title:"FlinkCheckpoint\u6e90\u7801\u5206\u6790",permalink:"/docs/Flink/FlinkCheckpoint\u6e90\u7801\u5206\u6790"},next:{title:"Flink\u7ef4\u8868\u5173\u8054\u65b9\u6848",permalink:"/docs/Flink/Flink\u7ef4\u8868\u5173\u8054\u65b9\u6848"}},c={},a=[{value:"Flink SQL \u7a97\u53e3",id:"flink-sql-\u7a97\u53e3",level:2},{value:"\u7a97\u53e3\u8868\u503c\u51fd\u6570",id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570",level:3},{value:"\u7a97\u53e3\u51fd\u6570",id:"\u7a97\u53e3\u51fd\u6570",level:3},{value:"\u6eda\u52a8\u7a97\u53e3\uff08TUMBLE\uff09",id:"\u6eda\u52a8\u7a97\u53e3tumble",level:4},{value:"\u6ed1\u52a8\u7a97\u53e3(HOP)",id:"\u6ed1\u52a8\u7a97\u53e3hop",level:4},{value:"\u4f1a\u8bdd\u7a97\u53e3",id:"\u4f1a\u8bdd\u7a97\u53e3",level:4},{value:"\u7d2f\u79ef\u7a97\u53e3",id:"\u7d2f\u79ef\u7a97\u53e3",level:4}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"flink-sql-\u7a97\u53e3",children:"Flink SQL \u7a97\u53e3"}),"\n",(0,t.jsx)(n.p,{children:"\u7a97\u53e3\u662f\u5904\u7406\u65e0\u9650\u6d41\u7684\u6838\u5fc3\u3002\u7a97\u53e3\u628a\u6d41\u5206\u5272\u4e3a\u6709\u9650\u5927\u5c0f\u7684 \u201c\u6876\u201d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u5176\u4e4b\u4e0a\u8fdb\u884c\u8ba1\u7b97\u3002\u672c\u6587\u6863\u805a\u7126\u4e8e\u7a97\u53e3\u5728 Flink SQL \u4e2d\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u7f16\u7a0b\u4eba\u5458\u5982\u4f55\u6700\u5927\u5316\u5730\u5229\u7528\u597d\u5b83\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["Apache Flink \u63d0\u4f9b\u4e86\u5982\u4e0b ",(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"}),"\uff08table-valued function, \u7f29\u5199TVF\uff09\u628a\u8868\u7684\u6570\u636e\u5212\u5206\u5230\u7a97\u53e3\u4e2d\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-tvf/#%E6%BB%9A%E5%8A%A8%E7%AA%97%E5%8F%A3tumble",children:"\u6eda\u52a8\u7a97\u53e3"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-tvf/#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3hop",children:"\u6ed1\u52a8\u7a97\u53e3"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-tvf/#%E7%B4%AF%E7%A7%AF%E7%AA%97%E5%8F%A3cumulate",children:"\u7d2f\u79ef\u7a97\u53e3"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-tvf/#%E4%BC%9A%E8%AF%9D%E7%AA%97%E5%8F%A3session",children:"\u4f1a\u8bdd\u7a97\u53e3"})," (\u76ee\u524d\u4ec5\u652f\u6301\u6d41\u6a21\u5f0f)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u903b\u8f91\u4e0a\uff0c\u6bcf\u4e2a\u5143\u7d20\u53ef\u4ee5\u5e94\u7528\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a\u7a97\u53e3\uff0c\u8fd9\u53d6\u51b3\u4e8e\u6240\u4f7f\u7528\u7684 ",(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"}),"\u3002\u4f8b\u5982\uff1a\u6ed1\u52a8\u7a97\u53e3\u53ef\u4ee5\u628a\u5355\u4e2a\u5143\u7d20\u5206\u914d\u7ed9\u591a\u4e2a\u7a97\u53e3\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"})," \u662f Flink \u5b9a\u4e49\u7684\u591a\u6001\u8868\u51fd\u6570\uff08Polymorphic Table Function\uff0c\u7f29\u5199PTF\uff09\uff0cPTF \u662f SQL 2016 \u6807\u51c6\u4e2d\u7684\u4e00\u79cd\u7279\u6b8a\u7684\u8868\u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u628a\u8868\u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\u3002PTF \u5728\u5bf9\u8868\u7684\u91cd\u5851\u4e0a\u5f88\u5f3a\u5927\u3002\u56e0\u4e3a\u5b83\u4eec\u7684\u8c03\u7528\u51fa\u73b0\u5728 ",(0,t.jsx)(n.code,{children:"SELECT"})," \u7684 ",(0,t.jsx)(n.code,{children:"FROM"})," \u4ece\u53e5\u91cc\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"})," \u662f ",(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-agg/#group-window-aggregation-deprecated",children:"\u5206\u7ec4\u7a97\u53e3\u51fd\u6570"})," \uff08\u5df2\u7ecf\u8fc7\u65f6\uff09\u7684\u66ff\u4ee3\u65b9\u6848\u3002",(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"})," \u66f4\u7b26\u5408 SQL \u6807\u51c6\uff0c\u5728\u652f\u6301\u57fa\u4e8e\u7a97\u53e3\u7684\u590d\u6742\u8ba1\u7b97\u4e0a\u4e5f\u66f4\u5f3a\u5927\u3002\u4f8b\u5982\uff1a\u7a97\u53e3 TopN\u3001\u7a97\u53e3 Join\u3002\u800c",(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-agg/#group-window-aggregation",children:"\u5206\u7ec4\u7a97\u53e3\u51fd\u6570"}),"\u53ea\u652f\u6301\u7a97\u53e3\u805a\u5408"]}),"\n",(0,t.jsx)(n.h3,{id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570",children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"})," \u662f Flink \u5b9a\u4e49\u7684\u591a\u6001\u8868\u51fd\u6570\uff08Polymorphic Table Function\uff0c\u7f29\u5199PTF\uff09\uff0cPTF \u662f SQL 2016 \u6807\u51c6\u4e2d\u7684\u4e00\u79cd\u7279\u6b8a\u7684\u8868\u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u628a\u8868\u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\u3002PTF \u5728\u5bf9\u8868\u7684\u91cd\u5851\u4e0a\u5f88\u5f3a\u5927\u3002\u56e0\u4e3a\u5b83\u4eec\u7684\u8c03\u7528\u51fa\u73b0\u5728 ",(0,t.jsx)(n.code,{children:"SELECT"})," \u7684 ",(0,t.jsx)(n.code,{children:"FROM"})," \u4ece\u53e5\u91cc\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"})," \u662f ",(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-agg/#group-window-aggregation-deprecated",children:"\u5206\u7ec4\u7a97\u53e3\u51fd\u6570"})," \uff08\u5df2\u7ecf\u8fc7\u65f6\uff09\u7684\u66ff\u4ee3\u65b9\u6848\u3002",(0,t.jsx)(n.code,{children:"\u7a97\u53e3\u8868\u503c\u51fd\u6570"})," \u66f4\u7b26\u5408 SQL \u6807\u51c6\uff0c\u5728\u652f\u6301\u57fa\u4e8e\u7a97\u53e3\u7684\u590d\u6742\u8ba1\u7b97\u4e0a\u4e5f\u66f4\u5f3a\u5927\u3002\u4f8b\u5982\uff1a\u7a97\u53e3 TopN\u3001\u7a97\u53e3 Join\u3002\u800c",(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-agg/#group-window-aggregation",children:"\u5206\u7ec4\u7a97\u53e3\u51fd\u6570"}),"\u53ea\u652f\u6301\u7a97\u53e3\u805a\u5408"]}),"\n",(0,t.jsx)(n.h3,{id:"\u7a97\u53e3\u51fd\u6570",children:"\u7a97\u53e3\u51fd\u6570"}),"\n",(0,t.jsx)(n.h4,{id:"\u6eda\u52a8\u7a97\u53e3tumble",children:"\u6eda\u52a8\u7a97\u53e3\uff08TUMBLE\uff09"}),"\n",(0,t.jsxs)(n.p,{children:["\u5c06\u6bcf\u4e2a\u5143\u7d20\u5206\u914d\u5230\u4e00\u4e2a\u6307\u5b9a\u5927\u5c0f\u7684\u7a97\u53e3\u4e2d\u3002\u901a\u5e38\uff0c\u6eda\u52a8\u7a97\u53e3\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u5927\u5c0f\uff0c\u5e76\u4e14\u4e0d\u4f1a\u51fa\u73b0\u91cd\u53e0\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u4e00\u4e2a5\u5206\u949f\u5927\u5c0f\u7684\u6eda\u52a8\u7a97\u53e3\uff0c\u65e0\u9650\u6d41\u7684\u6570\u636e\u4f1a\u6839\u636e\u65f6\u95f4\u5212\u5206\u4e3a",(0,t.jsx)(n.code,{children:"[0:00 - 0:05)"}),"\u3001",(0,t.jsx)(n.code,{children:"[0:05, 0:10)"}),"\u3001",(0,t.jsx)(n.code,{children:"[0:10, 0:15)"}),"\u7b49\u7a97\u53e3\u3002\u4e0b\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a30\u79d2\u7684\u6eda\u52a8\u7a97\u53e3"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"1102.png",src:i(7477).A+"",width:"1003",height:"603"})}),"\n",(0,t.jsx)(n.p,{children:"\u4f7f\u7528\u6807\u8bc6\u51fd\u6570\u9009\u51fa\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u6216\u8005\u7ed3\u675f\u65f6\u95f4\uff0c\u7a97\u53e3\u7684\u65f6\u95f4\u5c5e\u6027\u7528\u4e8e\u4e0b\u7ea7Window\u7684\u805a\u5408"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7a97\u53e3\u6807\u8bc6\u51fd\u6570"}),(0,t.jsx)(n.th,{children:"\u8fd4\u56de\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TUMBLE_START(time-attr, size-interval)"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\uff08\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:10, 00:15)"})," \u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:10"})," \u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TUMBLE_END(time-attr, size-interval)"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15]"}),"\u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:15"}),"\u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TUMBLE_ROWTIME(time-attr, size-interval)"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP(rowtime-attr)"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u4e0d\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15]"}),"\u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:14:59.999"})," \u3002\u8fd4\u56de\u503c\u662f\u4e00\u4e2arowtime attribute\uff0c\u5373\u53ef\u4ee5\u57fa\u4e8e\u8be5\u5b57\u6bb5\u505a\u65f6\u95f4\u5c5e\u6027\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u7ea7\u8054\u7a97\u53e3\u53ea\u80fd\u7528\u5728\u57fa\u4e8eEvent Time\u7684Window\u4e0a"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TUMBLE_PROCTIME(time-attr, size-interval)"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP(rowtime-attr)"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u4e0d\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15]"}),"\u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:14:59.999"}),"\u3002\u8fd4\u56de\u503c\u662f\u4e00\u4e2aproctime attribute\uff0c\u5373\u53ef\u4ee5\u57fa\u4e8e\u8be5\u5b57\u6bb5\u505a\u65f6\u95f4\u5c5e\u6027\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u7ea7\u8054\u7a97\u53e3\u53ea\u80fd\u7528\u5728\u57fa\u4e8eProcessing Time\u7684Window\u4e0a"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"TUMBLE window\u793a\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'import org.apache.flink.api.common.typeinfo.TypeHint;\nimport org.apache.flink.api.common.typeinfo.TypeInformation;\nimport org.apache.flink.api.java.tuple.Tuple3;\nimport org.apache.flink.streaming.api.TimeCharacteristic;\nimport org.apache.flink.streaming.api.datastream.DataStream;\nimport org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.streaming.api.functions.timestamps.AscendingTimestampExtractor;\nimport org.apache.flink.table.api.EnvironmentSettings;\nimport org.apache.flink.table.api.Table;\nimport org.apache.flink.table.api.bridge.java.StreamTableEnvironment;\n\n\nimport java.sql.Timestamp;\nimport java.util.Arrays;\n\npublic class TumbleWindowExample {\n\n    public static void main(String[] args) throws Exception {\n\n        /**\n         * 1 \u6ce8\u518c\u73af\u5883\n         */\n        EnvironmentSettings mySetting = EnvironmentSettings\n                .newInstance()\n//                .useOldPlanner()\n                .useBlinkPlanner()\n                .inStreamingMode()\n                .build();\n\n        // \u83b7\u53d6 environment\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n        // \u6307\u5b9a\u7cfb\u7edf\u65f6\u95f4\u6982\u5ff5\u4e3a event time\n        env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\n        StreamTableEnvironment tEnv = StreamTableEnvironment.create(env,mySetting);\n\n\n        // \u521d\u59cb\u6570\u636e\n        DataStream<Tuple3<Long, String,Integer>> log = env.fromCollection(Arrays.asList(\n                //\u65f6\u95f4 14:53:00\n                new Tuple3<>(1572591180_000L,"xiao_ming",300),\n                //\u65f6\u95f4 14:53:09\n                new Tuple3<>(1572591189_000L,"zhang_san",303),\n                //\u65f6\u95f4 14:53:12\n                new Tuple3<>(1572591192_000L, "xiao_li",204),\n                //\u65f6\u95f4 14:53:21\n                new Tuple3<>(1572591201_000L,"li_si", 208)\n                ));\n\n        // \u6307\u5b9a\u65f6\u95f4\u6233\n        SingleOutputStreamOperator<Tuple3<Long, String, Integer>> logWithTime = log.assignTimestampsAndWatermarks(new AscendingTimestampExtractor<Tuple3<Long, String, Integer>>() {\n\n            @Override\n            public long extractAscendingTimestamp(Tuple3<Long, String, Integer> element) {\n                return element.f0;\n            }\n        });\n\n        // \u8f6c\u6362\u4e3a Table\n        Table logT = tEnv.fromDataStream(logWithTime, "t.rowtime, name, v");\n\n        Table result = tEnv.sqlQuery("SELECT TUMBLE_START(t, INTERVAL \'10\' SECOND) AS window_start," +\n                "TUMBLE_END(t, INTERVAL \'10\' SECOND) AS window_end, SUM(v) FROM "\n                + logT + " GROUP BY TUMBLE(t, INTERVAL \'10\' SECOND)");\n\n        TypeInformation<Tuple3<Timestamp,Timestamp,Integer>> tpinf = new TypeHint<Tuple3<Timestamp,Timestamp,Integer>>(){}.getTypeInfo();\n        tEnv.toAppendStream(result, tpinf).print();\n\n        env.execute();\n    }\n\n\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"sql\u903b\u8f91\uff0c\u6bcf\u5341\u79d2\u949f\u805a\u5408\n\u6267\u884c\u7ed3\u679c\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"(2019-11-01 06:53:00.0,2019-11-01 06:53:10.0,603)\n(2019-11-01 06:53:20.0,2019-11-01 06:53:30.0,208)\n(2019-11-01 06:53:10.0,2019-11-01 06:53:20.0,204)\n\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u6ed1\u52a8\u7a97\u53e3hop",children:"\u6ed1\u52a8\u7a97\u53e3(HOP)"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u6ed1\u52a8\u7a97\u53e3\uff08HOP\uff09\uff0c\u4e5f\u88ab\u79f0\u4f5cSliding Window\u3002\u4e0d\u540c\u4e8e\u6eda\u52a8\u7a97\u53e3\uff0c\u6ed1\u52a8\u7a97\u53e3\u7684\u7a97\u53e3\u53ef\u4ee5\u91cd\u53e0\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u6ed1\u52a8\u7a97\u53e3\u6709\u4e24\u4e2a\u53c2\u6570\uff1aslide\u548csize\u3002slide\u4e3a\u6bcf\u6b21\u6ed1\u52a8\u7684\u6b65\u957f\uff0csize\u4e3a\u7a97\u53e3\u7684\u5927\u5c0f\u3002"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"slide < size\uff0c\u5219\u7a97\u53e3\u4f1a\u91cd\u53e0\uff0c\u6bcf\u4e2a\u5143\u7d20\u4f1a\u88ab\u5206\u914d\u5230\u591a\u4e2a\u7a97\u53e3\u3002"}),"\n",(0,t.jsx)(n.li,{children:"slide = size\uff0c\u5219\u7b49\u540c\u4e8e\u6eda\u52a8\u7a97\u53e3\uff08TUMBLE\uff09\u3002"}),"\n",(0,t.jsx)(n.li,{children:"slide > size\uff0c\u5219\u4e3a\u8df3\u8dc3\u7a97\u53e3\uff0c\u7a97\u53e3\u4e4b\u95f4\u4e0d\u91cd\u53e0\u4e14\u6709\u95f4\u9699\u3002"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u901a\u5e38\uff0c\u5927\u90e8\u5206\u5143\u7d20\u7b26\u5408\u591a\u4e2a\u7a97\u53e3\u60c5\u666f\uff0c\u7a97\u53e3\u662f\u91cd\u53e0\u7684\u3002\u56e0\u6b64\uff0c\u6ed1\u52a8\u7a97\u53e3\u5728\u8ba1\u7b97\u79fb\u52a8\u5e73\u5747\u6570\uff08moving averages\uff09\u65f6\u5f88\u5b9e\u7528\u3002\u4f8b\u5982\uff0c\u8ba1\u7b97\u8fc7\u53bb5\u5206\u949f\u6570\u636e\u7684\u5e73\u5747\u503c\uff0c\u6bcf10\u79d2\u949f\u66f4\u65b0\u4e00\u6b21\uff0c\u53ef\u4ee5\u8bbe\u7f6eslide\u4e3a10\u79d2\uff0csize\u4e3a5\u5206\u949f\u3002\u4e0b\u56fe\u4e3a\u60a8\u5c55\u793a\u95f4\u9694\u4e3a30\u79d2\uff0c\u7a97\u53e3\u5927\u5c0f\u4e3a1\u5206\u949f\u7684\u6ed1\u52a8\u7a97\u53e3\n",(0,t.jsx)(n.img,{alt:"12.png",src:i(300).A+"",width:"924",height:"613"})]}),"\n",(0,t.jsx)(n.p,{children:"\u4f7f\u7528\u6ed1\u52a8\u7a97\u53e3\u6807\u8bc6\u51fd\u6570\u9009\u51fa\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u6216\u8005\u7ed3\u675f\u65f6\u95f4\uff0c\u7a97\u53e3\u7684\u65f6\u95f4\u5c5e\u6027\u7528\u4e8e\u4e0b\u7ea7Window\u7684\u805a\u5408\u3002"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7a97\u53e3\u6807\u8bc6\u51fd\u6570"}),(0,t.jsx)(n.th,{children:"\u8fd4\u56de\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HOP_START\uff08<time-attr>, <slide-interval>, <size-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\uff08\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:10, 00:15)"})," \u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:10"})," \u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HOP_END\uff08<time-attr>, <slide-interval>, <size-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15)"})," \u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:15"}),"\u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HOP_ROWTIME\uff08<time-attr>, <slide-interval>, <size-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP\uff08rowtime-attr\uff09"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u4e0d\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15)"})," \u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:14:59.999"}),"\u3002\u8fd4\u56de\u503c\u662f\u4e00\u4e2arowtime attribute\uff0c\u5373\u53ef\u4ee5\u57fa\u4e8e\u8be5\u5b57\u6bb5\u505a\u65f6\u95f4\u7c7b\u578b\u7684\u64cd\u4f5c\uff0c\u53ea\u80fd\u7528\u5728\u57fa\u4e8eevent time\u7684window\u4e0a\u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HOP_PROCTIME\uff08<time-attr>, <slide-interval>, <size-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"TIMESTAMP\uff08rowtime-attr\uff09"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u4e0d\u5305\u542b\u8fb9\u754c\uff09\u3002\u4f8b\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15)"})," \u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:14:59.999"})," \u3002\u8fd4\u56de\u503c\u662f\u4e00\u4e2aproctime attribute"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"\u6ed1\u52a8\u7a97\u53e3\u5b9e\u4f8b\uff1a\njava\u4ee3\u7801\u540c\u4e0a\uff0csql\u8bed\u53e5\u6539\u4e3a\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT HOP_START(t, INTERVAL '5' SECOND, INTERVAL '10' SECOND) AS window_start,\" +\n                \"HOP_END(t, INTERVAL '5' SECOND, INTERVAL '10' SECOND) AS window_end, SUM(v) FROM \"\n                + logT + \" GROUP BY HOP(t, INTERVAL '5' SECOND, INTERVAL '10' SECOND)\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6bcf\u95f4\u96945\u79d2\u7edf\u8ba110\u79d2\u5185\u7684\u6570\u636e\nsql\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"(2019-11-01 06:53:15.0,2019-11-01 06:53:25.0,208)\n(2019-11-01 06:53:10.0,2019-11-01 06:53:20.0,204)\n(2019-11-01 06:53:05.0,2019-11-01 06:53:15.0,507)\n(2019-11-01 06:53:20.0,2019-11-01 06:53:30.0,208)\n(2019-11-01 06:53:00.0,2019-11-01 06:53:10.0,603)\n(2019-11-01 06:52:55.0,2019-11-01 06:53:05.0,300)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u4f1a\u8bdd\u7a97\u53e3",children:"\u4f1a\u8bdd\u7a97\u53e3"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u4f1a\u8bdd\u7a97\u53e3\uff08SESSION\uff09\u901a\u8fc7Session\u6d3b\u52a8\u6765\u5bf9\u5143\u7d20\u8fdb\u884c\u5206\u7ec4\u3002\u4f1a\u8bdd\u7a97\u53e3\u4e0e\u6eda\u52a8\u7a97\u53e3\u548c\u6ed1\u52a8\u7a97\u53e3\u76f8\u6bd4\uff0c\u6ca1\u6709\u7a97\u53e3\u91cd\u53e0\uff0c\u6ca1\u6709\u56fa\u5b9a\u7a97\u53e3\u5927\u5c0f\u3002\u76f8\u53cd\uff0c\u5f53\u5b83\u5728\u4e00\u4e2a\u56fa\u5b9a\u7684\u65f6\u95f4\u5468\u671f\u5185\u4e0d\u518d\u6536\u5230\u5143\u7d20\uff0c\u5373\u4f1a\u8bdd\u65ad\u5f00\u65f6\uff0c\u8fd9\u4e2a\u7a97\u53e3\u5c31\u4f1a\u5173\u95ed\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u6ce8\u610f:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u4f1a\u8bdd\u7a97\u53e3\u51fd\u6570\u76ee\u524d\u4e0d\u652f\u6301\u6279\u6a21\u5f0f\u3002"}),"\n",(0,t.jsxs)(n.li,{children:["\u4f1a\u8bdd\u7a97\u53e3\u51fd\u6570\u76ee\u524d\u4e0d\u652f\u6301 ",(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/tuning/",children:"\u6027\u80fd\u8c03\u4f18"})," \u4e2d\u7684\u4efb\u4f55\u4f18\u5316\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["\u4f1a\u8bdd\u7a97\u53e3 Join \u3001\u4f1a\u8bdd\u7a97\u53e3 Top-N \u3001\u4f1a\u8bdd\u7a97\u53e3\u805a\u5408\u529f\u80fd\u76ee\u524d\u7406\u8bba\u53ef\u7528\uff0c\u4f46\u4ecd\u5904\u4e8e\u5b9e\u9a8c\u9636\u6bb5\u3002\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u5728 ",(0,t.jsx)(n.a,{href:"https://issues.apache.org/jira/browse/FLINK",children:"JIRA"})," \u4e2d\u62a5\u544a\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u4f1a\u8bdd\u7a97\u53e3\u901a\u8fc7\u4e00\u4e2a\u95f4\u9694\u65f6\u95f4\uff08Gap\uff09\u6765\u914d\u7f6e\uff0c\u8fd9\u4e2a\u95f4\u9694\u5b9a\u4e49\u4e86\u975e\u6d3b\u8dc3\u5468\u671f\u7684\u957f\u5ea6\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u8868\u793a\u9f20\u6807\u70b9\u51fb\u6d3b\u52a8\u7684\u6570\u636e\u6d41\u53ef\u80fd\u5177\u6709\u957f\u65f6\u95f4\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u5e76\u5728\u4e24\u6bb5\u7a7a\u95f2\u4e4b\u95f4\u6563\u5e03\u7740\u9ad8\u6d53\u5ea6\u7684\u70b9\u51fb\u3002 \u5982\u679c\u6570\u636e\u5728\u6307\u5b9a\u7684\u95f4\u9694\uff08Gap\uff09\u4e4b\u540e\u5230\u8fbe\uff0c\u5219\u4f1a\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u7a97\u53e3\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["\u4f1a\u8bdd\u7a97\u53e3\u793a\u4f8b\u5982\u4e0b\u56fe\u3002\u6bcf\u4e2aKey\u7531\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u5206\u5e03\uff0c\u5f62\u6210\u4e86\u4e0d\u540c\u7684Window\u3002\n",(0,t.jsx)(n.img,{alt:"WX20240322-150100.png",src:i(189).A+"",width:"963",height:"684"})]}),"\n",(0,t.jsx)(n.p,{children:"\u4f7f\u7528\u6807\u8bc6\u51fd\u6570\u9009\u51fa\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u6216\u8005\u7ed3\u675f\u65f6\u95f4\uff0c\u7a97\u53e3\u7684\u65f6\u95f4\u5c5e\u6027\u7528\u4e8e\u4e0b\u7ea7Window\u7684\u805a\u5408\u3002"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7a97\u53e3\u6807\u8bc6\u51fd\u6570"}),(0,t.jsx)(n.th,{children:"\u8fd4\u56de\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SESSION_START\uff08<time-attr>, <gap-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"Timestamp"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\uff08\u5305\u542b\u8fb9\u754c\uff09\u3002\u5982",(0,t.jsx)(n.code,{children:"[00:10, 00:15)"})," \u7684\u7a97\u53e3\uff0c\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"00:10"})," \uff0c\u5373\u4e3a\u6b64\u4f1a\u8bdd\u7a97\u53e3\u5185\u7b2c\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u95f4\u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SESSION_END\uff08<time-attr>, <gap-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"Timestamp"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u5305\u542b\u8fb9\u754c\uff09\u3002\u5982",(0,t.jsx)(n.code,{children:"[00:00, 00:15)"})," \u7684\u7a97\u53e3\uff0c\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"00:15"}),"\uff0c\u5373\u4e3a\u6b64\u4f1a\u8bdd\u7a97\u53e3\u5185\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u95f4+",(0,t.jsx)(n.code,{children:"<gap-interval>"}),"\u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SESSION_ROWTIME\uff08<time-attr>, <gap-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"Timestamp\uff08rowtime-attr\uff09"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u4e0d\u5305\u542b\u8fb9\u754c\uff09\u3002\u5982 ",(0,t.jsx)(n.code,{children:"[00:00, 00:15)"})," \u7684\u7a97\u53e3\uff0c\u8fd4\u56de",(0,t.jsx)(n.code,{children:"00:14:59.999"})," \u3002\u8fd4\u56de\u503c\u662f\u4e00\u4e2arowtime attribute\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u57fa\u4e8e\u8be5\u5b57\u6bb5\u8fdb\u884c\u65f6\u95f4\u7c7b\u578b\u7684\u64cd\u4f5c\u3002\u8be5\u53c2\u6570\u53ea\u80fd\u7528\u4e8e\u57fa\u4e8eevent time\u7684window \u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SESSION_PROCTIME\uff08<time-attr>, <gap-interval>\uff09"})}),(0,t.jsx)(n.td,{children:"Timestamp\uff08rowtime-attr\uff09"}),(0,t.jsxs)(n.td,{children:["\u8fd4\u56de\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff08\u4e0d\u5305\u542b\u8fb9\u754c\uff09\u3002\u5982 ",(0,t.jsx)(n.code,{children:"[00:00, 00:15)"})," \u7684\u7a97\u53e3\uff0c\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"00:14:59.999"})," \u3002\u8fd4\u56de\u503c\u662f\u4e00\u4e2a proctime attribute\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u57fa\u4e8e\u8be5\u5b57\u6bb5\u8fdb\u884c\u65f6\u95f4\u7c7b\u578b\u7684\u64cd\u4f5c\u3002\u8be5\u53c2\u6570\u53ea\u80fd\u7528\u4e8e\u57fa\u4e8eprocessing time\u7684window \u3002"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"\u4f1a\u8bdd\u7a97\u53e3\u5b9e\u4f8b\uff1a\njava\u4ee3\u7801\u540c\u4e0a\nsql\u8bed\u53e5\u5982\u4e0b\uff1a\n\u6bcf\u96945\u79d2\u805a\u5408"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-n1ql",children:"\"SELECT SESSION_START(t, INTERVAL '5' SECOND) AS window_start,\" +\n                \"SESSION_END(t, INTERVAL '5' SECOND) AS window_end, SUM(v) FROM \"\n                + logT + \" GROUP BY SESSION(t, INTERVAL '5' SECOND)\"\n"})}),"\n",(0,t.jsx)(n.p,{children:"sql\u7ed3\u679c\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"(2019-11-01 06:53:21.0,2019-11-01 06:53:26.0,208)\n(2019-11-01 06:53:00.0,2019-11-01 06:53:05.0,300)\n(2019-11-01 06:53:09.0,2019-11-01 06:53:17.0,507)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u7d2f\u79ef\u7a97\u53e3",children:"\u7d2f\u79ef\u7a97\u53e3"}),"\n",(0,t.jsx)(n.p,{children:"\u7d2f\u79ef\u7a97\u53e3\u5728\u67d0\u4e9b\u573a\u666f\u4e2d\u975e\u5e38\u6709\u7528\uff0c\u6bd4\u5982\u8bf4\u63d0\u524d\u89e6\u53d1\u7684\u6eda\u52a8\u7a97\u53e3\u3002\u4f8b\u5982\uff1a\u6bcf\u65e5\u4eea\u8868\u76d8\u4ece 00:00 \u5f00\u59cb\u6bcf\u5206\u949f\u7ed8\u5236\u7d2f\u79ef UV\uff0c10:00 \u65f6 UV \u5c31\u662f\u4ece 00:00 \u5230 10:00 \u7684UV \u603b\u6570\u3002\u7d2f\u79ef\u7a97\u53e3\u53ef\u4ee5\u7b80\u5355\u4e14\u6709\u6548\u5730\u5b9e\u73b0\u5b83\u3002"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"CUMULATE"})," \u51fd\u6570\u6307\u5b9a\u5143\u7d20\u5230\u591a\u4e2a\u7a97\u53e3\uff0c\u4ece\u521d\u59cb\u7684\u7a97\u53e3\u5f00\u59cb\uff0c\u76f4\u5230\u8fbe\u5230\u6700\u5927\u7684\u7a97\u53e3\u5927\u5c0f\u7684\u7a97\u53e3\uff0c\u6240\u6709\u7684\u7a97\u53e3\u90fd\u5305\u542b\u5176\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u53e6\u5916\uff0c\u7a97\u53e3\u7684\u5f00\u59cb\u65f6\u95f4\u662f\u56fa\u5b9a\u7684\u3002 \u4f60\u53ef\u4ee5\u5c06 ",(0,t.jsx)(n.code,{children:"CUMULATE"})," \u51fd\u6570\u89c6\u4e3a\u9996\u5148\u5e94\u7528\u5177\u6709\u6700\u5927\u7a97\u53e3\u5927\u5c0f\u7684 ",(0,t.jsx)(n.code,{children:"TUMBLE"})," \u7a97\u53e3\uff0c\u7136\u540e\u5c06\u6bcf\u4e2a\u6eda\u52a8\u7a97\u53e3\u62c6\u5206\u4e3a\u5177\u6709\u76f8\u540c\u7a97\u53e3\u5f00\u59cb\u4f46\u7a97\u53e3\u7ed3\u675f\u6b65\u957f\u4e0d\u540c\u7684\u51e0\u4e2a\u7a97\u53e3\u3002 \u6240\u4ee5\u7d2f\u79ef\u7a97\u53e3\u4f1a\u4ea7\u751f\u91cd\u53e0\u5e76\u4e14\u6ca1\u6709\u56fa\u5b9a\u5927\u5c0f\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u4f8b\u5982\uff1a1\u5c0f\u65f6\u6b65\u957f\uff0c24\u5c0f\u65f6\u5927\u5c0f\u7684\u7d2f\u8ba1\u7a97\u53e3\uff0c\u6bcf\u5929\u53ef\u4ee5\u83b7\u5f97\u5982\u4e0b\u8fd9\u4e9b\u7a97\u53e3\uff1a",(0,t.jsx)(n.code,{children:"[00:00, 01:00)"}),"\uff0c",(0,t.jsx)(n.code,{children:"[00:00, 02:00)"}),"\uff0c",(0,t.jsx)(n.code,{children:"[00:00, 03:00)"}),"\uff0c \u2026\uff0c ",(0,t.jsx)(n.code,{children:"[00:00, 24:00)"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/fig/cumulating-windows.png",children:"https://nightlies.apache.org/flink/flink-docs-master/fig/cumulating-windows.png"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"CUMULATE"}),"\u3000\u51fd\u6570\u901a\u8fc7\u65f6\u95f4\u5c5e\u6027\u5b57\u6bb5\u4e3a\u6bcf\u4e00\u884c\u6570\u636e\u5206\u914d\u4e86\u4e00\u4e2a\u7a97\u53e3\u3002 \u5728\u6d41\u8ba1\u7b97\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u65f6\u95f4\u5c5e\u6027\u5b57\u6bb5\u5fc5\u987b\u88ab\u6307\u5b9a\u4e3a ",(0,t.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/concepts/time_attributes/",children:"\u4e8b\u4ef6\u6216\u5904\u7406\u65f6\u95f4\u5c5e\u6027"}),"\u3002 \u5728\u6279\u8ba1\u7b97\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u7a97\u53e3\u8868\u51fd\u6570\u7684\u65f6\u95f4\u5c5e\u6027\u5b57\u6bb5\u5fc5\u987b\u662f ",(0,t.jsx)(n.code,{children:"TIMESTAMP"})," \u6216 ",(0,t.jsx)(n.code,{children:"TIMESTAMP_LTZ"})," \u7684\u7c7b\u578b\u3002 ",(0,t.jsx)(n.code,{children:"CUMULATE"})," \u7684\u8fd4\u56de\u503c\u5305\u62ec\u539f\u59cb\u8868\u7684\u6240\u6709\u5217\u548c\u9644\u52a0\u7684\u4e09\u4e2a\u7528\u4e8e\u6307\u5b9a\u7a97\u53e3\u7684\u5217\uff0c\u5206\u522b\u662f\uff1a\u201cwindow_start\u201d\uff0c\u201cwindow_end\u201d\uff0c\u201cwindow_time\u201d\u3002\u51fd\u6570\u8fd0\u884c\u540e\uff0c\u539f\u6709\u7684\u65f6\u95f4\u5c5e\u6027 \u201ctimecol\u201d \u5c06\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5e38\u89c4\u7684 timestamp \u5217\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"CUMULATE"})," \u6709\u56db\u4e2a\u5fc5\u586b\u53c2\u6570\u548c\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CUMULATE(TABLE data, DESCRIPTOR(timecol), step, size)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"data"}),"\uff1a\u62e5\u6709\u65f6\u95f4\u5c5e\u6027\u5217\u7684\u8868\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"timecol"}),"\uff1a\u5217\u63cf\u8ff0\u7b26\uff0c\u51b3\u5b9a\u6570\u636e\u7684\u54ea\u4e2a\u65f6\u95f4\u5c5e\u6027\u5217\u5e94\u8be5\u6620\u5c04\u5230\u7a97\u53e3\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"step"}),"\uff1a\u6307\u5b9a\u8fde\u7eed\u7684\u7d2f\u79ef\u7a97\u53e3\u4e4b\u95f4\u589e\u52a0\u7684\u7a97\u53e3\u5927\u5c0f\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"size"}),"\uff1a\u6307\u5b9a\u7d2f\u79ef\u7a97\u53e3\u7684\u6700\u5927\u5bbd\u5ea6\u7684\u7a97\u53e3\u65f6\u95f4\u3002",(0,t.jsx)(n.code,{children:"size"}),"\u5fc5\u987b\u662f",(0,t.jsx)(n.code,{children:"step"}),"\u7684\u6574\u6570\u500d\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"offset"}),"\uff1a\u7a97\u53e3\u7684\u504f\u79fb\u91cf [\u975e\u5fc5\u586b]\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u4e0b\u9762\u662f ",(0,t.jsx)(n.code,{children:"Bid"})," \u8868\u7684\u8c03\u7528\u793a\u4f8b\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"> SELECT * FROM TABLE(\n    CUMULATE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '2' MINUTES, INTERVAL '10' MINUTES));\n-- or with the named params\n-- note: the DATA param must be the first\n> SELECT * FROM TABLE(\n    CUMULATE(\n      DATA => TABLE Bid,\n      TIMECOL => DESCRIPTOR(bidtime),\n      STEP => INTERVAL '2' MINUTES,\n      SIZE => INTERVAL '10' MINUTES));\n+------------------+-------+------+------------------+------------------+-------------------------+\n|          bidtime | price | item |     window_start |       window_end |            window_time  |\n+------------------+-------+------+------------------+------------------+-------------------------+\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:06 | 2020-04-15 08:05:59.999 |\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:08 | 2020-04-15 08:07:59.999 |\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:00 | 2020-04-15 08:08 | 2020-04-15 08:07:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:09 |  5.00 | D    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:12 | 2020-04-15 08:11:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:14 | 2020-04-15 08:13:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:16 | 2020-04-15 08:15:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:18 | 2020-04-15 08:17:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:14 | 2020-04-15 08:13:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:16 | 2020-04-15 08:15:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:18 | 2020-04-15 08:17:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:10 | 2020-04-15 08:18 | 2020-04-15 08:17:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n+------------------+-------+------+------------------+------------------+-------------------------+\n\n-- apply aggregation on the cumulating windowed table\n> SELECT window_start, window_end, SUM(price) AS total_price\n  FROM TABLE(\n    CUMULATE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '2' MINUTES, INTERVAL '10' MINUTES))\n  GROUP BY window_start, window_end;\n+------------------+------------------+-------------+\n|     window_start |       window_end | total_price |\n+------------------+------------------+-------------+\n| 2020-04-15 08:00 | 2020-04-15 08:06 |        4.00 |\n| 2020-04-15 08:00 | 2020-04-15 08:08 |        6.00 |\n| 2020-04-15 08:00 | 2020-04-15 08:10 |       11.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:12 |        3.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:14 |        4.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:16 |        4.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:18 |       10.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 |       10.00 |\n+------------------+------------------+-------------+\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},7477:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/1102-2edf854d54cfdbbc25b5b3d4e58f54cd.png"},300:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/12-be79ca1d49a83946966f1799b2549d51.png"},189:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/WX20240322-150100-63f1c2f030580d829cea010eeb05940b.png"},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>l});var t=i(6540);const s={},r=t.createContext(s);function d(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);