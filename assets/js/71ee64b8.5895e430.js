"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8893],{7408:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>a,metadata:()=>t,toc:()=>d});var n=r(4848),i=r(8453);const a={},l=void 0,t={id:"spark/Spark\u5b9e\u8df5",title:"Spark\u5b9e\u8df5",description:"\u4ec0\u4e48\u662fRDD2",source:"@site/docs/spark/Spark\u5b9e\u8df5.md",sourceDirName:"spark",slug:"/spark/Spark\u5b9e\u8df5",permalink:"/docs/spark/Spark\u5b9e\u8df5",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/spark/Spark\u5b9e\u8df5.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Spark\u9762\u8bd5\u9898",permalink:"/docs/spark/Spark\u9762\u8bd5\u9898"}},c={},d=[{value:"\u4ec0\u4e48\u662fRDD2",id:"\u4ec0\u4e48\u662frdd2",level:2},{value:"\u6982\u5ff5",id:"\u6982\u5ff5",level:3},{value:"RDD\u7684\u4e94\u4e2a\u7279\u6027",id:"rdd\u7684\u4e94\u4e2a\u7279\u6027",level:3},{value:"RDD\u7279\u70b9",id:"rdd\u7279\u70b9",level:3},{value:"\u5e38\u89c1\u7b97\u5b50",id:"\u5e38\u89c1\u7b97\u5b50",level:2},{value:"\u805a\u5408\u7b97\u5b50",id:"\u805a\u5408\u7b97\u5b50",level:3},{value:"\u91cd\u65b0\u5206\u533a\u7b97\u5b50",id:"\u91cd\u65b0\u5206\u533a\u7b97\u5b50",level:3},{value:"\u6392\u5e8f\u7b97\u5b50",id:"\u6392\u5e8f\u7b97\u5b50",level:3},{value:"\u6620\u5c04\u7b97\u5b50",id:"\u6620\u5c04\u7b97\u5b50",level:3},{value:"\u53bb\u91cd\u7b97\u5b50",id:"\u53bb\u91cd\u7b97\u5b50",level:3},{value:"Shuffer\u7b97\u6cd5",id:"shuffer\u7b97\u6cd5",level:2},{value:"HashShuffer\u7684\u8fed\u4ee3",id:"hashshuffer\u7684\u8fed\u4ee3",level:3},{value:"Sort Based Shuffer",id:"sort-based-shuffer",level:3},{value:"\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b<br></br><br></br>",id:"\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b",level:2},{value:"\u6570\u636e\u503e\u659c",id:"\u6570\u636e\u503e\u659c",level:2},{value:"\u4ec0\u4e48\u662f\u6570\u636e\u503e\u659c",id:"\u4ec0\u4e48\u662f\u6570\u636e\u503e\u659c",level:3},{value:"\u6570\u636e\u503e\u659c\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898",id:"\u6570\u636e\u503e\u659c\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898",level:3},{value:"\u5982\u4f55\u89e3\u51b3\u6570\u636e\u503e\u659c",id:"\u5982\u4f55\u89e3\u51b3\u6570\u636e\u503e\u659c",level:3},{value:"\u57fa\u672c\u601d\u8def",id:"\u57fa\u672c\u601d\u8def",level:4},{value:"\u8fc7\u6ee4\u5f02\u5e38\u6570\u636e",id:"\u8fc7\u6ee4\u5f02\u5e38\u6570\u636e",level:4},{value:"\u4f18\u5316\u5143\u6570\u636e",id:"\u4f18\u5316\u5143\u6570\u636e",level:4},{value:"\u4f18\u5316Map\u7aef\u6570\u636e",id:"\u4f18\u5316map\u7aef\u6570\u636e",level:4},{value:"\u4f18\u5316Shuffle\u903b\u8f91",id:"\u4f18\u5316shuffle\u903b\u8f91",level:4},{value:"\u4f7f\u7528MapJoin",id:"\u4f7f\u7528mapjoin",level:4},{value:"\u8c03\u6574reduce\u5e76\u884c\u5ea6",id:"\u8c03\u6574reduce\u5e76\u884c\u5ea6",level:4},{value:"key \u52a0\u76d0",id:"key-\u52a0\u76d0",level:4},{value:"Checkpoint",id:"checkpoint",level:2},{value:"\u7f13\u5b58",id:"\u7f13\u5b58",level:2},{value:"Cache",id:"cache",level:3},{value:"Persist",id:"persist",level:3},{value:"\u5b58\u50a8\u7ea7\u522b",id:"\u5b58\u50a8\u7ea7\u522b",level:3},{value:"\u7f13\u5b58\u5220\u9664\u7b56\u7565",id:"\u7f13\u5b58\u5220\u9664\u7b56\u7565",level:3},{value:"\u7d2f\u52a0\u5668\u548c\u5e7f\u64ad\u53d8\u91cf",id:"\u7d2f\u52a0\u5668\u548c\u5e7f\u64ad\u53d8\u91cf",level:2},{value:"\u7d2f\u52a0\u5668",id:"\u7d2f\u52a0\u5668",level:3},{value:"\u5e7f\u64ad\u53d8\u91cf",id:"\u5e7f\u64ad\u53d8\u91cf",level:3},{value:"DataFrame\u548cDataSet",id:"dataframe\u548cdataset",level:2},{value:"\u533a\u522b",id:"\u533a\u522b",level:3}];function h(e){const s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h2,{id:"\u4ec0\u4e48\u662frdd2",children:"\u4ec0\u4e48\u662fRDD2"}),"\n",(0,n.jsxs)(s.p,{children:["\u53c2\u8003\uff1a",(0,n.jsx)(s.a,{href:"https://cloud.tencent.com/developer/article/1780260",children:"https://cloud.tencent.com/developer/article/1780260"})]}),"\n",(0,n.jsx)(s.h3,{id:"\u6982\u5ff5",children:"\u6982\u5ff5"}),"\n",(0,n.jsxs)(s.p,{children:["RDD\uff08Resilient Distributed Dataset\uff09\u53eb\u505a\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff0c\u662fSpark\u4e2d\u6700\u57fa\u672c\u7684\u6570\u636e\u62bd\u8c61\u3002\u4ee3\u7801\u4e2d\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5b83\u4ee3\u8868\u4e00\u4e2a\u4e0d\u53ef\u53d8\u3001\u53ef\u5206\u533a\u3001\u91cc\u9762\u7684\u5143\u7d20\u53ef",(0,n.jsx)(s.a,{href:"https://cloud.tencent.com/product/gpu?from=20065&from_column=20065",children:"\u5e76\u884c\u8ba1\u7b97"}),"\u7684\u96c6\u5408\u3002"]}),"\n",(0,n.jsx)(s.h3,{id:"rdd\u7684\u4e94\u4e2a\u7279\u6027",children:"RDD\u7684\u4e94\u4e2a\u7279\u6027"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["1\uff09 A list of partitions",(0,n.jsx)("br",{}),"\u4e00\u4e2a\u5206\u533a\u5217\u8868\uff0c\u4e00\u4e2ardd\u6709\u591a\u4e2a\u5206\u533a\uff0c\u540e\u671fspark\u4efb\u52a1\u8ba1\u7b97\u662f\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\uff0c\u4e00\u4e2a\u5206\u533a\u5c31\u5bf9\u5e94\u4e0a\u4e00\u4e2atask\u7ebf\u7a0b\u3002 \u901a\u8fc7val rdd1=sc.textFile(\u6587\u4ef6) \u5982\u679c\u8fd9\u4e2a\u6587\u4ef6\u5927\u5c0f\u7684block\u4e2a\u6570\u5c0f\u4e8e\u7b49\u4e8e2\uff0c\u5b83\u4ea7\u751f\u7684rdd\u7684\u5206\u533a\u6570\u5c31\u662f2 \u5982\u679c\u8fd9\u4e2a\u6587\u4ef6\u5927\u5c0f\u7684block\u4e2a\u6570\u5927\u4e8e2\uff0c\u5b83\u4ea7\u751f\u7684rdd\u7684\u5206\u533a\u6570\u8ddf\u6587\u4ef6\u7684block\u76f8\u540c\u3002",(0,n.jsx)("br",{}),"- 2\uff09A function for computing each split",(0,n.jsx)("br",{}),"\u7531\u4e00\u4e2a\u51fd\u6570\u8ba1\u7b97\u6bcf\u4e00\u4e2a\u5206\u7247 \u6bd4\u5982\uff1a rdd2=rdd1.map(x=>(x,1)) \uff0c\u8fd9\u91cc\u6307\u7684\u5c31\u662f\u6bcf\u4e2a\u5355\u8bcd\u8ba1\u4e3a1\u7684\u51fd\u6570",(0,n.jsx)("br",{}),"- 3\uff09A list of dependencies on other RDDs",(0,n.jsx)("br",{}),"\u4e00\u4e2ardd\u4f1a\u4f9d\u8d56\u4e8e\u5176\u4ed6\u591a\u4e2ardd\uff0c\u8fd9\u91cc\u5c31\u6d89\u53ca\u5230rdd\u4e0erdd\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u540e\u671fspark\u4efb\u52a1\u7684\u5bb9\u9519\u673a\u5236\u5c31\u662f\u6839\u636e\u8fd9\u4e2a\u7279\u6027\u800c\u6765\u3002 \u6bd4\u5982\uff1a rdd2=rdd1.map(x=>(x,1)) rdd2\u7684\u7ed3\u679c\u662f\u901a\u8fc7rdd1\u8c03\u7528\u4e86map\u65b9\u6cd5\u751f\u6210\uff0c\u90a3\u4e48rdd2\u5c31\u4f9d\u8d56\u4e8erdd1\u7684\u7ed3\u679c \u5bf9\u5176\u4ed6RDD\u7684\u4f9d\u8d56\u5217\u8868\uff0c\u4f9d\u8d56\u8fd8\u5177\u4f53\u5206\u4e3a\u5bbd\u4f9d\u8d56\u548c\u7a84\u4f9d\u8d56\uff0c\u4f46\u5e76\u4e0d\u662f\u6240\u6709\u7684RDD\u90fd\u6709\u4f9d\u8d56\u3002",(0,n.jsx)("br",{}),"- 4)Optionally, a Partitioner for key-value RDDs (e.g. to say that the RDD is hash-partitioned)",(0,n.jsx)("br",{}),"(\u53ef\u9009\u9879) \u5bf9\u4e8ekv\u7c7b\u578b\u7684rdd\u624d\u4f1a\u6709\u5206\u533a\u51fd\u6570\uff08\u5fc5\u987b\u8981\u4ea7\u751fshuffle\uff09\uff0c\u5bf9\u4e8e\u4e0d\u662fkv\u7c7b\u578b\u7684rdd\u5206\u533a\u51fd\u6570\u662fNone\u3002 \u5206\u533a\u51fd\u6570\u7684\u4f5c\u7528\uff1a\u5b83\u662f\u51b3\u5b9a\u4e86\u539f\u59cbrdd\u7684\u6570\u636e\u4f1a\u6d41\u5165\u5230\u4e0b\u9762rdd\u7684\u54ea\u4e9b\u5206\u533a\u4e2d\u3002 spark\u7684\u5206\u533a\u51fd\u6570\u67092\u79cd\uff1a\u7b2c\u4e00\u79cdhashPartitioner\uff08\u9ed8\u8ba4\u503c\uff09, \u901a\u8fc7 key.hashcode % \u5206\u533a\u6570=\u5206\u533a\u53f7 \u7b2c\u4e8c\u79cdRangePartitioner,\u662f\u57fa\u4e8e\u4e00\u5b9a\u7684\u8303\u56f4\u8fdb\u884c\u5206\u533a\u3002",(0,n.jsx)("br",{}),"- 5)Optionally, a list of preferred locations to compute each split on (e.g. block locations for an HDFS file)",(0,n.jsx)("br",{}),"(\u53ef\u9009\u9879) \u4e00\u7ec4\u6700\u4f18\u7684\u6570\u636e\u5757\u7684\u4f4d\u7f6e\uff0c\u8fd9\u91cc\u6d89\u53ca\u5230\u6570\u636e\u7684\u672c\u5730\u6027\u548c\u6570\u636e\u4f4d\u7f6e\u6700\u4f18 spark\u540e\u671f\u5728\u8fdb\u884c\u4efb\u52a1\u8c03\u5ea6\u7684\u65f6\u5019\uff0c\u4f1a\u4f18\u5148\u8003\u8651\u5b58\u6709\u6570\u636e\u7684worker\u8282\u70b9\u6765\u8fdb\u884c\u4efb\u52a1\u7684\u8ba1\u7b97\u3002\u5927\u5927\u51cf\u5c11\u6570\u636e\u7684\u7f51\u7edc\u4f20\u8f93\uff0c\u63d0\u5347\u6027\u80fd\u3002\u8fd9\u91cc\u5c31\u8fd0\u7528\u5230\u4e86",(0,n.jsx)(s.a,{href:"https://cloud.tencent.com/solution/bigdata?from=20065&from_column=20065",children:"\u5927\u6570\u636e"}),"\u4e2d\u79fb\u52a8\u6570\u636e\u4e0d\u5982\u79fb\u52a8\u8ba1\u7b97\u7406\u5ff5\u3002"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"rdd\u7279\u70b9",children:"RDD\u7279\u70b9"}),"\n",(0,n.jsx)(s.p,{children:"RDD\u8868\u793a\u53ea\u8bfb\u7684\u5206\u533a\u7684\u6570\u636e\u96c6\uff0c\u5bf9RDD\u8fdb\u884c\u6539\u52a8\uff0c\u53ea\u80fd\u901a\u8fc7RDD\u7684\u8f6c\u6362\u64cd\u4f5c\uff0c\u7531\u4e00\u4e2aRDD\u5f97\u5230\u4e00\u4e2a\u65b0\u7684RDD\uff0c\u65b0\u7684RDD\u5305\u542b\u4e86\u4ece\u5176\u4ed6RDD\u884d\u751f\u6240\u5fc5\u9700\u7684\u4fe1\u606f\u3002RDDs\u4e4b\u95f4\u5b58\u5728\u4f9d\u8d56\uff0cRDD\u7684\u6267\u884c\u662f\u6309\u7167\u8840\u7f18\u5173\u7cfb\u5ef6\u65f6\u8ba1\u7b97\u7684\u3002\u5982\u679c\u8840\u7f18\u5173\u7cfb\u8f83\u957f\uff0c\u53ef\u4ee5\u901a\u8fc7\u6301\u4e45\u5316RDD\u6765\u5207\u65ad\u8840\u7f18\u5173\u7cfb\u3002"}),"\n",(0,n.jsx)(s.h2,{id:"\u5e38\u89c1\u7b97\u5b50",children:"\u5e38\u89c1\u7b97\u5b50"}),"\n",(0,n.jsxs)(s.p,{children:["\u4ece\u5c0f\u65b9\u5411\u6765\u8bf4\uff0cSpark \u7b97\u5b50\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u4e09\u7c7b:",(0,n.jsx)("br",{}),"1\uff09Value\u6570\u636e\u7c7b\u578b\u7684Transformation\u7b97\u5b50\uff0c\u8fd9\u79cd\u53d8\u6362\u5e76\u4e0d\u89e6\u53d1\u63d0\u4ea4\u4f5c\u4e1a\uff0c\u9488\u5bf9\u5904\u7406\u7684\u6570\u636e\u9879\u662fValue\u578b\u7684\u6570\u636e\u3002",(0,n.jsx)("br",{}),"2\uff09Key-Value\u6570\u636e\u7c7b\u578b\u7684Transfromation\u7b97\u5b50\uff0c\u8fd9\u79cd\u53d8\u6362\u5e76\u4e0d\u89e6\u53d1\u63d0\u4ea4\u4f5c\u4e1a\uff0c\u9488\u5bf9\u5904\u7406\u7684\u6570\u636e\u9879\u662fKey-Value\u578b\u7684\u6570\u636e\u5bf9\u3002",(0,n.jsx)("br",{}),"3\uff09Action\u7b97\u5b50\uff0c\u8fd9\u7c7b\u7b97\u5b50\u4f1a\u89e6\u53d1SparkContext\u63d0\u4ea4Job\u4f5c\u4e1a\u3002"]}),"\n",(0,n.jsx)(s.h3,{id:"\u805a\u5408\u7b97\u5b50",children:"\u805a\u5408\u7b97\u5b50"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["**ReduceByKeyApache Spark \u4e2d\u7528\u4e8e\u5bf9\u952e\u503c\u5bf9 RDD \u8fdb\u884c\u805a\u5408\u64cd\u4f5c\u7684\u8f6c\u6362\u7b97\u5b50\u4e4b\u4e00\u3002\u5b83\u5bf9\u5177\u6709\u76f8\u540c\u952e\u7684\u503c\u8fdb\u884c\u672c\u5730\u5f52\u7ea6\uff0c\u7136\u540e\u5728\u6574\u4e2a\u6570\u636e\u96c6\u4e0a\u8fdb\u884c\u5168\u5c40\u5f52\u7ea6\u3002",(0,n.jsx)(s.strong,{children:"reduceByKey"})," \u7684\u57fa\u672c\u4f5c\u7528\u662f\u5c06\u76f8\u540c\u952e\u7684\u503c\u6309\u7167\u7ed9\u5b9a\u7684\u5f52\u7ea6\u51fd\u6570\u8fdb\u884c\u5408\u5e76\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u5177\u4f53\u6765\u8bf4\uff0c",(0,n.jsx)(s.strong,{children:"reduceByKey"})," \u7684\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"def reduceByKey(func: (V, V) => V): RDD[(K, V)]\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"groupByKey"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Apache Spark \u4e2d\u7528\u4e8e\u5bf9\u952e\u503c\u5bf9 RDD \u8fdb\u884c\u5206\u7ec4\u64cd\u4f5c\u7684\u8f6c\u6362\u7b97\u5b50\u4e4b\u4e00\u3002\u5b83\u5c06\u5177\u6709\u76f8\u540c\u952e\u7684\u6240\u6709\u503c\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2a\u952e\u5bf9\u5e94\u7684\u503c\u7684\u96c6\u5408\u3002\u5177\u4f53\u6765\u8bf4\uff0c",(0,n.jsx)(s.strong,{children:"groupByKey"})," \u7684\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"def groupByKey(): RDD[(K, Iterable[V])]\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"3",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"aggregateByKey"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Apache Spark \u4e2d\u7528\u4e8e\u5bf9\u952e\u503c\u5bf9 RDD \u8fdb\u884c\u805a\u5408\u64cd\u4f5c\u7684\u9ad8\u7ea7\u8f6c\u6362\u7b97\u5b50\u3002\u5b83\u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u7075\u6d3b\u6027\uff0c\u5141\u8bb8\u7528\u6237\u5728\u6bcf\u4e2a\u952e\u4e0a\u6267\u884c\u4e0d\u540c\u7684\u521d\u59cb\u5316\u3001\u5408\u5e76\u548c\u6700\u7ec8\u805a\u5408\u903b\u8f91\u3002",(0,n.jsx)(s.strong,{children:"aggregateByKey"})," \u7684\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"def aggregateByKey[U: ClassTag](zeroValue: U)(\n  seqOp: (U, V) => U, combOp: (U, U) => U): RDD[(K, U)]\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u5176\u4e2d\uff1a"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"zeroValue"})," \u662f\u4e00\u4e2a\u521d\u59cb\u503c\uff0c\u7528\u4e8e\u4e3a\u6bcf\u4e2a\u952e\u521b\u5efa\u4e00\u4e2a\u7d2f\u52a0\u5668\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"seqOp"})," \u662f\u4e00\u4e2a\u4e8c\u5143\u64cd\u4f5c\u7b26\uff0c\u7528\u4e8e\u5c06\u6bcf\u4e2a\u503c\u5408\u5e76\u5230\u7d2f\u52a0\u5668\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"combOp"})," \u662f\u4e00\u4e2a\u4e8c\u5143\u64cd\u4f5c\u7b26\uff0c\u7528\u4e8e\u5c06\u4e24\u4e2a\u7d2f\u52a0\u5668\u5408\u5e76\u6210\u4e00\u4e2a\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["**      groupByKey\u3001reduceByKey\u3001aggregateByKey\u533a\u522b**",(0,n.jsx)("br",{})," \u4e09\u8005\u90fd\u53ef\u4ee5\u505a\u5206\u7ec4\u64cd\u4f5c\u3002reduceByKey\u3001aggregateByKey\u4e0d\u4f46\u5206\u7ec4\u8fd8\u505a\u4e86\u805a\u5408\u64cd\u4f5c"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"groupByKey\u76f4\u63a5\u8fdb\u884cshuffle\u64cd\u4f5c\uff0c\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u901f\u5ea6\u8f83\u6162\u3002"}),"\n",(0,n.jsx)(s.li,{children:"reduceByKey\u3001aggregateByKey\u5728shuffle\u4e4b\u524d\u53ef\u80fd\u4f1a\u5148\u8fdb\u884c\u805a\u5408\uff0c\u805a\u5408\u540e\u7684\u6570\u636e\u518d\u8fdb\u884cshuffle\uff0c\u8fd9\u6837\u4e00\u6765\u8fdb\u884cshuffle\u7684\u6570\u636e\u4f1a\u53d8\u5c11\uff0c\u901f\u5ea6\u4f1a\u5feb\u3002"}),"\n",(0,n.jsx)(s.li,{children:"reduceByKey\u3001aggregateByKey\u7684\u533a\u522b\u662f\u524d\u8005\u4e0d\u540cpartition\u4ee5\u53capartition\u4e4b\u95f4\u7684\u805a\u5408\u64cd\u4f5c\u662f\u4e00\u6837\u7684\uff0c\u800c\u540e\u8005\u53ef\u4ee5\u6307\u5b9a\u4e24\u79cd\u64cd\u4f5c\u6765\u5bf9\u5e94\u4e8epartition\u4e4b\u95f4\u548cpartition\u5185\u90e8\u4e0d\u540c\u7684\u805a\u5408\u64cd\u4f5c\uff0c\u5e76\u4e14aggregateByKey\u53ef\u4ee5\u6307\u5b9a\u521d\u59cb\u503c\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u5728aggregateByKey\u4e2d\uff0c\u5982\u679c\u4e24\u79cd\u64cd\u4f5c\u662f\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528foldByKey\u6765\u4ee3\u66ff\uff0c\u5e76\u4e14\u53ea\u4f20\u4e00\u4e2a\u64cd\u4f5c\u51fd\u6570\u3002foldBykey\u548creudceBykey\u7684\u533a\u522b\u662f\u524d\u8005\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u521d\u59cb\u503c"}),"\n"]}),"\n",(0,n.jsxs)(s.ol,{start:"4",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"foldByKey"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u662faggregateByKey\u51fd\u6570\u7684\u7279\u6b8a\u5f62\u5f0f\uff0c\u5373\u7b80\u5199\u5f62\u5f0f\u3002",(0,n.jsx)("br",{}),"**\u529f\u80fd\uff1a**\u6839\u636e\u8bbe\u5b9a\u89c4\u5219\u540c\u65f6\u8fdb\u884c\u5206\u533a\u95f4\u7684\u8ba1\u7b97\u548c\u5206\u533a\u5185\u7684\u8ba1\u7b97\uff0c\u5177\u4f53\u4e3a\uff0c",(0,n.jsx)("br",{}),"\uff081\uff09\u5728\u5206\u533a\u5185\u6309\u7167\u76f8\u540c\u7684key\u8fdb\u884c\u67d0\u79cd\u89c4\u5219\u8ba1\u7b97\uff1b",(0,n.jsx)("br",{}),"\uff082\uff09\u5206\u533a\u5185\u90e8\u8ba1\u7b97\u5b8c\u540e\uff0c\u63a5\u7740\u8ba1\u7b97\u5206\u533a\u95f4\u7684\u540c\u6837\u4f9d\u636e\u76f8\u540c\u7684key\u6309\u7167\u89c4\u5219\u8fdb\u884c\u8ba1\u7b97\uff0c",(0,n.jsx)(s.strong,{children:"\u6ce8\u610f\uff1a\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u7684\u8ba1\u7b97\u89c4\u5219\u662f\u4e00\u6837\u7684\u3002"})]}),"\n",(0,n.jsxs)(s.ol,{start:"5",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"combineByKey"})}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"\u91cd\u65b0\u5206\u533a\u7b97\u5b50",children:"\u91cd\u65b0\u5206\u533a\u7b97\u5b50"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"**repartition\t**"}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"repartition"})," \u662f Apache Spark \u4e2d\u7528\u4e8e\u6539\u53d8 RDD \u5206\u533a\u6570\u91cf\u7684\u8f6c\u6362\u7b97\u5b50\u3002\u5b83\u7528\u4e8e\u91cd\u65b0\u7ec4\u7ec7\u6570\u636e\u5e76\u66f4\u6539 RDD \u7684\u5206\u533a\u5206\u5e03\uff0c\u53ef\u4ee5\u589e\u52a0\u6216\u51cf\u5c11\u5206\u533a\u7684\u6570\u91cf\u3002",(0,n.jsx)(s.strong,{children:"repartition"})," \u7684\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:" /**\n   * Return a new RDD that has exactly numPartitions partitions.\n   *\n   * Can increase or decrease the level of parallelism in this RDD. Internally, this uses\n   * a shuffle to redistribute data.\n   *\n   * If you are decreasing the number of partitions in this RDD, consider using `coalesce`,\n   * which can avoid performing a shuffle.\n   */\n  def repartition(numPartitions: Int)(implicit ord: Ordering[T] = null): RDD[T] = withScope {\n    coalesce(numPartitions, shuffle = true)\n  }\n\n"})}),"\n",(0,n.jsxs)(s.p,{children:["\u5176\u4e2d ",(0,n.jsx)(s.strong,{children:"numPartitions"})," \u662f\u5e0c\u671b\u5f97\u5230\u7684\u65b0\u5206\u533a\u6570\u91cf\u3002"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"repartition\u53ef\u4ee5\u5c06\u5206\u533a\u7684\u5e76\u884c\u5ea6\u589e\u52a0\uff0c\u4e5f\u53ef\u4ee5\u5c06\u5206\u533a\u7684\u5e76\u884c\u5ea6\u51cf\u5c11"}),"\n",(0,n.jsxs)(s.li,{children:["\u53ef\u4ee5\u770b\u5230repartition\u8c03\u7528\u4e86coalesce\u65b9\u6cd5\uff0c\u5e76\u4e14\u4f20\u5165\u7684shuffle\u53c2\u6570\u662ftrue\u3002\u6362\u53e5\u8bf4\u8bdd\uff0c\u5c31\u662f\u65e0\u8bba\u5206\u533a\u6570\u662f\u589e\u52a0\u8fd8\u662f\u51cf\u5c11",(0,n.jsx)(s.strong,{children:"\u90fd\u4f1a\u6267\u884cshuffle"}),"\u64cd\u4f5c\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u4f7f\u7528 ",(0,n.jsx)(s.strong,{children:"repartition"})," \u65f6\uff0cSpark \u5c06\u91cd\u65b0\u5206\u914d\u6570\u636e\u4ee5\u9002\u5e94\u65b0\u7684\u5206\u533a\u6570\uff0c\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u6570\u636e\u7684\u79fb\u52a8\u548c\u7f51\u7edc\u4f20\u8f93\u3002\u56e0\u6b64\uff0c\u8c28\u614e\u4f7f\u7528 ",(0,n.jsx)(s.strong,{children:"repartition"}),"\uff0c\u7279\u522b\u662f\u5728\u5927\u89c4\u6a21\u6570\u636e\u96c6\u4e0a\uff0c\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5f00\u9500\u3002"]}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"coalesce"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"coalesce"})," \u662f Spark \u4e2d\u7684\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u7528\u4e8e\u51cf\u5c11 RDD \u7684\u5206\u533a\u6570\u91cf\u3002\u4e0e ",(0,n.jsx)(s.strong,{children:"repartition"})," \u4e0d\u540c\uff0c",(0,n.jsx)(s.strong,{children:"coalesce"})," \u4e3b\u8981\u7528\u4e8e\u51cf\u5c11\u5206\u533a\u6570\u91cf\uff0c\u800c\u4e0d\u8fdb\u884c\u6570\u636e\u7684 shuffle\uff08\u4e0d\u8fdb\u884c\u6570\u636e\u7684\u7f51\u7edc\u4f20\u8f93\u548c\u91cd\u5206\u914d\uff09\u3002\u56e0\u6b64\uff0c\u76f8\u5bf9\u4e8e",(0,n.jsx)(s.strong,{children:"repartition"}),"\uff0c",(0,n.jsx)(s.strong,{children:"coalesce"})," \u66f4\u52a0\u8f7b\u91cf\u7ea7\u3002",(0,n.jsx)("br",{}),(0,n.jsx)(s.strong,{children:"coalesce"})," \u7684\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"def coalesce(numPartitions: Int, shuffle: Boolean = false, partitionCoalescer: Option[PartitionCoalescer] = Option.empty)\n  (implicit ord: Ordering[T] = null): RDD[T]\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u5176\u4e2d\uff1a"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"numPartitions"})," \u662f\u5e0c\u671b\u5f97\u5230\u7684\u65b0\u5206\u533a\u6570\u91cf\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"shuffle"})," \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u662f\u5426\u8fdb\u884c shuffle\u3002\u9ed8\u8ba4\u4e3a ",(0,n.jsx)(s.strong,{children:"false"}),"\uff0c\u5373\u4e0d\u8fdb\u884c shuffle\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"partitionCoalescer"})," \u662f\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u5206\u533a\u5408\u5e76\u5668"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u6211\u4eec\u5e38\u8ba4\u4e3acoalesce\u4e0d\u4ea7\u751fshuffle\u4f1a\u6bd4repartition \u4ea7\u751fshuffle\u6548\u7387\u9ad8\uff0c\u800c\u5b9e\u9645\u60c5\u51b5\u5f80\u5f80\u8981\u6839\u636e\u5177\u4f53\u95ee\u9898\u5177\u4f53\u5206\u6790\uff0ccoalesce\u6548\u7387\u4e0d\u4e00\u5b9a\u9ad8\uff0c\u6709\u65f6\u8fd8\u6709\u5927\u5751\uff0c\u5927\u5bb6\u8981\u614e\u7528\u3002 coalesce \u4e0e repartition \u4ed6\u4eec\u4e24\u4e2a\u90fd\u662fRDD\u7684\u5206\u533a\u8fdb\u884c\u91cd\u65b0\u5212\u5206\uff0crepartition\u53ea\u662fcoalesce\u63a5\u53e3\u4e2dshuffle\u4e3atrue\u7684\u5b9e\u73b0\uff08\u5047\u8bbe\u6e90RDD\u6709N\u4e2a\u5206\u533a\uff0c\u9700\u8981\u91cd\u65b0\u5212\u5206\u6210M\u4e2a\u5206\u533a\uff09 ",(0,n.jsx)("br",{}),"1\uff09\u5982\u679c \u3002\u4e00\u822c\u60c5\u51b5\u4e0bN\u4e2a\u5206\u533a\u6709\u6570\u636e\u5206\u5e03\u4e0d\u5747\u5300\u7684\u72b6\u51b5\uff0c\u5229\u7528HashPartitioner\u51fd\u6570\u5c06\u6570\u636e\u91cd\u65b0\u5206\u533a\u4e3aM\u4e2a\uff0c\u8fd9\u65f6\u9700\u8981\u5c06shuffle\u8bbe\u7f6e\u4e3atrue(repartition\u5b9e\u73b0,coalesce\u4e5f\u5b9e\u73b0\u4e0d\u4e86)\u3002 ",(0,n.jsx)("br",{}),"2\uff09\u5982\u679cN>M\u5e76\u4e14N\u548cM\u76f8\u5dee\u4e0d\u591a\uff0c(\u5047\u5982N\u662f1000\uff0cM\u662f100)\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c06N\u4e2a\u5206\u533a\u4e2d\u7684\u82e5\u5e72\u4e2a\u5206\u533a\u5408\u5e76\u6210\u4e00\u4e2a\u65b0\u7684\u5206\u533a\uff0c\u6700\u7ec8\u5408\u5e76\u4e3aM\u4e2a\u5206\u533a\uff0c\u8fd9\u65f6\u53ef\u4ee5\u5c06shuff\u8bbe\u7f6e\u4e3afalse\uff08coalesce\u5b9e\u73b0\uff09\uff0c\u5982\u679cM>N\u65f6\uff0ccoalesce\u662f\u65e0\u6548\u7684\uff0c\u4e0d\u8fdb\u884cshuffle\u8fc7\u7a0b\uff0c\u7236RDD\u548c\u5b50RDD\u4e4b\u95f4\u662f\u7a84\u4f9d\u8d56\u5173\u7cfb\uff0c\u65e0\u6cd5\u4f7f\u6587\u4ef6\u6570(partiton)\u53d8\u591a\u3002 \u603b\u4e4b\u5982\u679cshuffle\u4e3afalse\u65f6\uff0c\u5982\u679c\u4f20\u5165\u7684\u53c2\u6570\u5927\u4e8e\u73b0\u6709\u7684\u5206\u533a\u6570\u76ee\uff0cRDD\u7684\u5206\u533a\u6570\u4e0d\u53d8\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u7ecf\u8fc7shuffle\uff0c\u662f\u65e0\u6cd5\u5c06RDD\u7684\u5206\u533a\u6570\u53d8\u591a\u7684 ",(0,n.jsx)("br",{}),"3\uff09\u5982\u679cN>M\u5e76\u4e14\u4e24\u8005\u76f8\u5dee\u60ac\u6b8a\uff0c\u8fd9\u65f6\u4f60\u8981\u770bexecutor\u6570\u4e0e\u8981\u751f\u6210\u7684partition\u5173\u7cfb\uff0c\u5982\u679cexecutor\u6570 \u5c0f\u4e8e\u7b49\u4e8e \u8981\u751f\u6210partition\u6570\uff0ccoalesce\u6548\u7387\u9ad8\uff0c\u53cd\u4e4b\u5982\u679c\u7528coalesce\u4f1a\u5bfc\u81f4(executor\u6570-\u8981\u751f\u6210partiton\u6570)\u4e2aexcutor\u7a7a\u8dd1\u4ece\u800c\u964d\u4f4e\u6548\u7387\u3002\u5982\u679c\u5728M\u4e3a1\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u4f7fcoalesce\u4e4b\u524d\u7684\u64cd\u4f5c\u6709\u66f4\u597d\u7684\u5e76\u884c\u5ea6\uff0c\u53ef\u4ee5\u5c06shuffle\u8bbe\u7f6e\u4e3atrue"]}),"\n",(0,n.jsx)(s.h3,{id:"\u6392\u5e8f\u7b97\u5b50",children:"\u6392\u5e8f\u7b97\u5b50"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"sortBy"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"sortBy"})," \u662f Apache Spark \u4e2d\u7684\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u7528\u4e8e\u5bf9 RDD \u4e2d\u7684\u5143\u7d20\u8fdb\u884c\u6392\u5e8f\u3002\u4e0e ",(0,n.jsx)(s.strong,{children:"sortByKey"})," \u4e0d\u540c\uff0c",(0,n.jsx)(s.strong,{children:"sortBy"})," \u5141\u8bb8\u5bf9\u5143\u7d20\u7684\u4efb\u610f\u5c5e\u6027\u8fdb\u884c\u6392\u5e8f\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u952e\u3002",(0,n.jsx)(s.strong,{children:"sortBy"})," \u7684\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"def sortBy[K](f: (T) => K, ascending: Boolean = true, numPartitions: Int = this.partitions.length)\n  (implicit ord: Ordering[K], ctag: ClassTag[K]): RDD[T]\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u5176\u4e2d\uff1a"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"f"})," \u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5c06\u5143\u7d20\u6620\u5c04\u5230\u9700\u8981\u6392\u5e8f\u7684\u952e\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ascending"})," \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u5347\u5e8f\u8fd8\u662f\u964d\u5e8f\u6392\u5e8f\uff0c\u9ed8\u8ba4\u4e3a\u5347\u5e8f\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"numPartitions"})," \u662f\u7ed3\u679c RDD \u7684\u5206\u533a\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a\u539f\u59cb RDD \u7684\u5206\u533a\u6570\u91cf\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ord"})," \u662f\u4e00\u4e2a\u9690\u5f0f\u53c2\u6570\uff0c\u8868\u793a\u6392\u5e8f\u7684\u987a\u5e8f\uff0cSpark \u4f1a\u6839\u636e\u88ab\u6392\u5e8f\u7684\u7c7b\u578b\u63a8\u65ad\u51fa\u9002\u5f53\u7684\u9690\u5f0f ",(0,n.jsx)(s.strong,{children:"Ordering"}),"\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ctag"})," \u662f\u4e00\u4e2a\u9690\u5f0f\u53c2\u6570\uff0c\u8868\u793a\u6392\u5e8f\u952e\u7684 ",(0,n.jsx)(s.strong,{children:"ClassTag"}),"\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"sortByKey"})}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"\u5728\u4e00\u4e2a(K,V)\u7684RDD\u4e0a\u8c03\u7528\uff0cK\u5fc5\u987b\u5b9e\u73b0Ordered\u63a5\u53e3\uff0c\u8fd4\u56de\u4e00\u4e2a\u6309\u7167key\u8fdb\u884c\u6392\u5e8f\u7684(K,V)\u7684RDD"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ascending"}),"\uff1a\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u6392\u5e8f\u987a\u5e8f\uff0c\u9ed8\u8ba4\u4e3a ",(0,n.jsx)(s.strong,{children:"true"}),"\uff0c\u5373\u5347\u5e8f\u6392\u5e8f\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"numPartitions"}),"\uff1a\u7ed3\u679c RDD \u7684\u5206\u533a\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a\u539f\u59cb RDD \u7684\u5206\u533a\u6570\u91cf\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ord"}),"\uff1a\u9690\u5f0f\u53c2\u6570\uff0c\u8868\u793a\u6392\u5e8f\u7684\u987a\u5e8f\uff0cSpark \u4f1a\u6839\u636e\u952e\u7684\u7c7b\u578b\u63a8\u65ad\u51fa\u9002\u5f53\u7684\u9690\u5f0f ",(0,n.jsx)(s.strong,{children:"Ordering"}),"\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ctag"}),"\uff1a\u9690\u5f0f\u53c2\u6570\uff0c\u8868\u793a\u6392\u5e8f\u952e\u7684 ",(0,n.jsx)(s.strong,{children:"ClassTag"})]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"\u6620\u5c04\u7b97\u5b50",children:"\u6620\u5c04\u7b97\u5b50"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"map"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"map"})," \u662f Apache Spark \u4e2d\u7684\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u7528\u4e8e\u5bf9 RDD \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u6267\u884c\u6307\u5b9a\u7684\u6620\u5c04\u64cd\u4f5c\u3002\u5b83\u5c06\u4e00\u4e2a RDD \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u901a\u8fc7\u4e00\u4e2a\u7528\u6237\u5b9a\u4e49\u7684\u51fd\u6570\u8fdb\u884c\u6620\u5c04\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684 RDD\u3002",(0,n.jsx)(s.strong,{children:"map"})," \u7684\u57fa\u672c\u7b7e\u540d\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"def map[U: ClassTag](f: T => U): RDD[U]\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"flatMap"})}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"flatMap \u5176\u5b9e\u548c map \u4e0e mapPartitions \u7b97\u5b50\u7c7b\u4f3c\uff0c\u5728\u529f\u80fd\u4e0a\uff0c\u4e0e map \u548c mapPartitions \u4e00\u6837\uff0cflatMap \u4e5f\u662f\u7528\u6765\u505a\u6570\u636e\u6620\u5c04\u7684\uff0c\u5728\u5b9e\u73b0\u4e0a\uff0c\u5bf9\u4e8e\u7ed9\u5b9a\u6620\u5c04\u51fd\u6570 f\uff0cflatMap(f) \u4ee5\u5143\u7d20\u4e3a\u7c92\u5ea6\uff0c\u5bf9 RDD \u8fdb\u884c\u6570\u636e\u8f6c\u6362\u3002\u4e0d\u8fc7\uff0c\u4e0e\u524d\u4e24\u8005\u76f8\u6bd4\uff0cflatMap \u7684\u6620\u5c04\u51fd\u6570 f \u6709\u7740\u663e\u8457\u7684\u4e0d\u540c\u3002\u5bf9\u4e8e map \u548c mapPartitions \u6765\u8bf4\uff0c\u5176\u6620\u5c04\u51fd\u6570 f \u7684\u7c7b\u578b\uff0c\u90fd\u662f\uff08\u5143\u7d20\uff09 => \uff08\u5143\u7d20\uff09\uff0c\u5373\u5143\u7d20\u5230\u5143\u7d20\u3002\u800c flatMap \u6620\u5c04\u51fd\u6570 f \u7684\u7c7b\u578b\uff0c\u662f\uff08\u5143\u7d20\uff09 => \uff08\u96c6\u5408\uff09\uff0c\u5373\u5143\u7d20\u5230\u96c6\u5408\uff08\u5982\u6570\u7ec4\u3001\u5217\u8868\u7b49\uff09\u3002\u56e0\u6b64\uff0cflatMap \u7684\u6620\u5c04\u8fc7\u7a0b\u5728\u903b\u8f91\u4e0a\u5206\u4e3a\u4e24\u6b65\uff1a"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"\u4ee5\u5143\u7d20\u4e3a\u5355\u4f4d\uff0c\u521b\u5efa\u96c6\u5408\uff1b"}),"\n",(0,n.jsx)(s.li,{children:"\u53bb\u6389\u96c6\u5408\u201c\u5916\u5305\u88c5\u201d\uff0c\u63d0\u53d6\u96c6\u5408\u5143\u7d20\u3002"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-scala",children:'// \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\nval lineRDD: RDD[String] = sc.parallelize(List("Apache Spark is a fast and general-purpose cluster computing system."))\n// \u4ee5\u884c\u4e3a\u5355\u4f4d\u63d0\u53d6\u76f8\u90bb\u5355\u8bcd\nval wordPairRDD: RDD[String] = lineRDD.flatMap( line => {\n  // \u5c06\u884c\u8f6c\u6362\u4e3a\u5355\u8bcd\u6570\u7ec4\n  val words: Array[String] = line.split(" ")\n  // \u5c06\u5355\u4e2a\u5355\u8bcd\u6570\u7ec4\uff0c\u8f6c\u6362\u4e3a\u76f8\u90bb\u5355\u8bcd\u6570\u7ec4\n  val list = for (i <- 0 until words.length - 1) yield words(i) + "-" + words(i+1)\n  println("list: " + list)\n  list.iterator  //\u8fd4\u56delist\u7684\u8fed\u4ee3\u5668,\u6700\u7ec8\u6240\u6709\u7684\u96c6\u5408\u5143\u7d20\u90fd\u4f1a\u88ab\u62bd\u5230\u4e00\u4e2a\u96c6\u5408\u4e2d\n})\nwordPairRDD.collect().foreach(x=>println(x))\n'})}),"\n",(0,n.jsxs)(s.ol,{start:"3",children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"mapPartition"}),"mapPartitions** \u662f Apache Spark \u4e2d\u7684\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u5b83\u5141\u8bb8\u5bf9 RDD \u4e2d\u7684\u6bcf\u4e2a\u5206\u533a\u5e94\u7528\u4e00\u4e2a\u51fd\u6570\u3002\u4e0e ",(0,n.jsx)(s.strong,{children:"map"})," \u548c ",(0,n.jsx)(s.strong,{children:"flatMap"})," \u4e0d\u540c\uff0c",(0,n.jsx)(s.strong,{children:"mapPartitions"})," \u64cd\u4f5c\u7684\u662f\u6574\u4e2a\u5206\u533a\u7684\u6570\u636e\u800c\u4e0d\u662f\u5355\u4e2a\u5143\u7d20\uff0c\u8fd9\u4f7f\u5f97\u5b83\u66f4\u9002\u5408\u5904\u7406\u5206\u533a\u7ea7\u522b\u7684\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u6bcf\u4e2a\u5143\u7d20\u7684\u64cd\u4f5c\u3002"]}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"mapPartitionWithIndex"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"mapPartitionsWithIndex"})," \u662f Apache Spark \u4e2d\u7684\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u7c7b\u4f3c\u4e8e ",(0,n.jsx)(s.strong,{children:"mapPartitions"}),"\uff0c\u4f46\u5b83\u989d\u5916\u63d0\u4f9b\u4e86\u5206\u533a\u7684\u7d22\u5f15\u4fe1\u606f\u3002\u8fd9\u4e2a\u7b97\u5b50\u5141\u8bb8\u5bf9 RDD \u4e2d\u7684\u6bcf\u4e2a\u5206\u533a\u5e94\u7528\u4e00\u4e2a\u51fd\u6570\uff0c\u5e76\u4f20\u9012\u5206\u533a\u7d22\u5f15\u4f5c\u4e3a\u53c2\u6570\u3002\u8fd9\u6837\uff0c\u4f60\u53ef\u4ee5\u5728\u5904\u7406\u6bcf\u4e2a\u5206\u533a\u65f6\u6839\u636e\u5206\u533a\u7d22\u5f15\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002"]}),"\n",(0,n.jsx)(s.h3,{id:"\u53bb\u91cd\u7b97\u5b50",children:"\u53bb\u91cd\u7b97\u5b50"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.strong,{children:"distinct"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"distinct"})," \u662f Apache Spark \u4e2d\u7684\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u7528\u4e8e\u53bb\u9664 RDD \u4e2d\u7684\u91cd\u590d\u5143\u7d20\uff0c\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u552f\u4e00\u5143\u7d20\u7684\u65b0\u7684 RDD",(0,n.jsx)("br",{}),(0,n.jsx)(s.strong,{children:"distinit\u539f\u7406"}),(0,n.jsx)("br",{}),"\u6211\u4eec\u770b\u4e0b\u6e90\u7801"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-scala",children:"/**   * Return a new RDD containing the distinct elements in this RDD.   */  \ndef distinct(numPartitions: Int(implicit ord: Ordering[T] = null): RDD[T] = withScope {    \n    map(x => (x, null)).reduceByKey((x, y) => x, numPartitions).map(_._1)  \n}  \n\n/**   * Return a new RDD containing the distinct elements in this RDD.   */\ndef distinct(): RDD[T] = withScope {    \n    distinct(partitions.length)  \n}\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u4e0a\u9762\u662fdistinct\u7684\u6e90\u7801\uff0c\u6709\u5e26\u53c2\u548c\u65e0\u53c2\u4e24\u79cd\u3002\u5f53\u6211\u4eec\u8c03\u7528\u65e0\u53c2\u7684distinct\u65f6\uff0c\u5e95\u5c42\u8c03\u7528\u7684\u662f\u5982\u4e0b\u6e90\u7801"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"def distinct(): RDD[T] = withScope {    \n  distinct(partitions.length)  \n}\n"})}),"\n",(0,n.jsxs)(s.p,{children:["\u5e26\u53c2\u6570\u7684distinct\u5176\u5185\u90e8\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u4e86\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2awordcount\u7edf\u8ba1\u5355\u8bcd\u7684\u65b9\u6cd5\uff0c\u533a\u522b\u662f\uff1a\u540e\u8005\u901a\u8fc7\u5143\u7ec4\u83b7\u53d6\u4e86\u7b2c\u4e00\u4e2a\u5355\u8bcd\u5143\u7d20\u3002",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{src:"https://cdn.nlark.com/yuque/0/2023/webp/390265/1702985724430-8753831e-58aa-4e4c-a756-249422c57e14.webp#averageHue=%23f6f6f6&clientId=u4d1050a1-fe82-4&from=paste&id=uf0a688b6&originHeight=263&originWidth=640&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ucaf51d76-56d4-4b1e-9607-f12911cb409&title=",alt:""}),(0,n.jsx)("br",{}),"\u603b\u7ed3\uff1a\u4f7f\u7528map\u7b97\u5b50\u628a\u5143\u7d20\u8f6c\u4e3a\u4e00\u4e2a\u5e26\u6709null\u7684\u5143\u7ec4\uff1b\u4f7f\u7528reducebykey\u5bf9\u5177\u6709\u76f8\u540ckey\u7684\u5143\u7d20\u8fdb\u884c\u7edf\u8ba1\uff1b\u4e4b\u540e\u518d\u4f7f\u7528map\u7b97\u5b50\uff0c\u53d6\u5f97\u5143\u7ec4\u4e2d\u7684\u5355\u8bcd\u5143\u7d20\uff0c\u5b9e\u73b0\u53bb\u91cd\u7684\u6548\u679c\u3002"]}),"\n",(0,n.jsx)(s.h2,{id:"shuffer\u7b97\u6cd5",children:"Shuffer\u7b97\u6cd5"}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsx)(s.p,{children:"Spark\u67092\u79cdShuffer\u65b9\u6cd5\uff0c\u7b2c\u4e00\u79cd\u662fHashShuffer\uff0c\u7b2c\u4e8c\u79cd\u662fSortShuffer\u3002"}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"HashShuffer\u5728\u65e7\u7684\u7248\u672c\u4e2d\u5148\u4f7f\u7528\u7684\uff0c\u7c7b\u4f3c\u4e8eMapReduce,\u4f46\u662f\u533a\u522b\u5728\u4e8eSpark\u4e2d\u7684HashShuffer\u6ca1\u6709\u6392\u5e8f\uff0c\u800cMapReduce HashShuffer\u4e2d\u662f\u6709\u6392\u5e8f\u7684\uff0c\u4f46\u662f\u540e\u9762\u7684\u7248\u672c\u4e2d\uff0cSpark\u5c06HashShuffer\u6362\u6210\u4e86SortShuffer\u3002"}),"\n",(0,n.jsx)(s.h3,{id:"hashshuffer\u7684\u8fed\u4ee3",children:"HashShuffer\u7684\u8fed\u4ee3"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"\u666e\u901ahashShuffer"}),(0,n.jsx)("br",{}),"\u7b2c\u4e00\u7248\u662f\u76f4\u63a5Map\u7aef\u7684Task\u76f4\u63a5\u6839\u636e\u4e0b\u6e38\u7684Reduce\u7684Task\u7684\u6570\u91cf\u7136\u540e\u5c06\u5bf9\u5e94\u5c5e\u4e8ereducetask\u5206\u533a\u7684\u6570\u636e\u5199\u5165\u5230\u672c\u5730\u78c1\u76d8\u6587\u4ef6\u3002 ",(0,n.jsx)("br",{}),"\u5047\u8bbeMap\u7aef\u67092\u4e2aExecutor\uff0c\u6bcf\u4e2aExecutor\u4e2d\u67092\u4e2aMap task\uff0c\u800c\u4e0b\u6e38\u6709\u4e00\u4e2aReduce\uff0cReduce\u4e2d\u67093\u4e2atask\u3002\u5982\u4e0b\u56fe\uff1a",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{alt:"img.png",src:r(2633).A+"",width:"750",height:"455"}),(0,n.jsx)("br",{}),"Map\u7aef\u7684task\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5206\u522b\u5199\u5165\u5230\u672c\u5730\u7684\u591a\u4e2a\u6587\u4ef6\u4e2d\uff0c\u6bcf\u4e2a\u6587\u4ef6\u5bf9\u5e94\u7684\u662f\u4e0b\u6e38\u4e2d\u7684\u4e00\u4e2areduce task\u3002\u7531\u4e8e\u603b\u5171\u67093\u4e2areduce task\uff0c\u6240\u6709\u4e00\u4e2amap task \u9700\u8981\u751f\u6210\u4e09\u4e2areduce task\u7684\u6587\u4ef6\u3002",(0,n.jsx)("br",{}),"\u8fd9\u6837\u7684\u8bdd\uff0c2\u4e2aexecutor\u4e2d\u67094\u4e2atask\uff0c\u6bcf\u4e2amap task \u9700\u8981\u751f\u62103\u4e2areduce task\u3002\u5c31\u9700\u8981\u751f\u62104*3 = 12 \u4e2atask\u6587\u4ef6\u3002",(0,n.jsx)("br",{}),"task\u6587\u4ef6\u6570\u91cf= MapTask\u6570\u91cf * ReduceTask\u7684\u6570\u91cf\u3002 ",(0,n.jsx)("br",{}),"\u8fd9\u6837\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53MapTask\u548cReduceTask\u7684\u6570\u91cf\u6bd4\u8f83\u591a\u65f6\uff0c\u4f1a\u5bfc\u81f4task\u6587\u4ef6\u7684\u6570\u91cf\u7206\u70b8\u6027\u7684\u589e\u957f\u3002IO\u6027\u80fd\u4f1a\u964d\u4f4e\u3002\u6240\u4ee5\u540e\u9762Spark\u629b\u5f03\u4e86\u8fd9\u79cd\u65b9\u5f0f\u3002",(0,n.jsx)("br",{}),"\u53c2\u8003\uff1a"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://alstonwilliams.github.io/spark/2019/02/17/Spark%E6%9E%B6%E6%9E%84-Shuffle(%E8%AF%91)/",children:"https://alstonwilliams.github.io/spark/2019/02/17/Spark%E6%9E%B6%E6%9E%84-Shuffle(%E8%AF%91)/"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"V2ConsolidatedShuffle\uff08\u6587\u4ef6\u5408\u5e76\u7684HashShuffer\uff09"}),(0,n.jsx)("br",{}),"\u57fa\u4e8e\u7b2c\u4e00\u7248HashShuffer\u7684\u7f3a\u70b9(\u751f\u6210\u7684task\u6587\u4ef6\u592a\u591a\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u9700\u8981\u5b58\u50a8\u5927\u91cf\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u800c\u4e14\u4f1a\u5f15\u8d77\u6d77\u91cf\u7684IO\u8bfb\u5199)\uff0cSpark\u53c8\u4f7f\u7528\u4e86\u7b2c\u4e8c\u7248\u7684Shuffer\u7b97\u6cd5\u3002",(0,n.jsx)("br",{}),"\u4e3a\u4e86\u4f18\u5316 HashShuffleManager \u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u53c2\u6570\uff1aspark.shuffle.consolidateFiles\uff0c\u8be5\u53c2\u6570\u9ed8\u8ba4\u503c\u4e3a false\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a true \u5373\u53ef\u5f00\u542f\u4f18\u5316\u673a\u5236\uff0c\u901a\u5e38\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528 HashShuffleManager\uff0c\u90a3\u4e48\u90fd\u5efa\u8bae\u5f00\u542f\u8fd9\u4e2a\u9009\u9879\u3002"]}),"\n",(0,n.jsx)(s.p,{children:"\u5f00\u542f consolidate \u673a\u5236\u4e4b\u540e\uff0c\u5728 shuffle write \u8fc7\u7a0b\u4e2d\uff0ctask \u5c31\u4e0d\u662f\u4e3a\u4e0b\u6e38 stage \u7684\u6bcf\u4e2a task \u521b\u5efa\u4e00\u4e2a\u78c1\u76d8\u6587\u4ef6\u4e86\uff0c\u6b64\u65f6\u4f1a\u51fa\u73b0shuffleFileGroup\u7684\u6982\u5ff5\uff0c\u6bcf\u4e2a shuffleFileGroup \u4f1a\u5bf9\u5e94\u4e00\u6279\u78c1\u76d8\u6587\u4ef6\uff0c\u78c1\u76d8\u6587\u4ef6\u7684\u6570\u91cf\u4e0e\u4e0b\u6e38 stage \u7684 task \u6570\u91cf\u662f\u76f8\u540c\u7684\u3002\u4e00\u4e2a Executor \u4e0a\u6709\u591a\u5c11\u4e2a cpu core\uff0c\u5c31\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u591a\u5c11\u4e2a task\u3002\u800c\u7b2c\u4e00\u6279\u5e76\u884c\u6267\u884c\u7684\u6bcf\u4e2a task \u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a shuffleFileGroup\uff0c\u5e76\u5c06\u6570\u636e\u5199\u5165\u5bf9\u5e94\u7684\u78c1\u76d8\u6587\u4ef6\u5185\u3002"}),"\n",(0,n.jsx)(s.p,{children:"\u5f53 Executor \u7684 cpu core \u6267\u884c\u5b8c\u4e00\u6279 task\uff0c\u63a5\u7740\u6267\u884c\u4e0b\u4e00\u6279 task \u65f6\uff0c\u4e0b\u4e00\u6279 task \u5c31\u4f1a\u590d\u7528\u4e4b\u524d\u5df2\u6709\u7684 shuffleFileGroup\uff0c\u5305\u62ec\u5176\u4e2d\u7684\u78c1\u76d8\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6b64\u65f6 task \u4f1a\u5c06\u6570\u636e\u5199\u5165\u5df2\u6709\u7684\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u800c\u4e0d\u4f1a\u5199\u5165\u65b0\u7684\u78c1\u76d8\u6587\u4ef6\u4e2d\u3002\u56e0\u6b64\uff0cconsolidate \u673a\u5236\u5141\u8bb8\u4e0d\u540c\u7684 task \u590d\u7528\u540c\u4e00\u6279\u78c1\u76d8\u6587\u4ef6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6709\u6548\u5c06\u591a\u4e2a task \u7684\u78c1\u76d8\u6587\u4ef6\u8fdb\u884c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7684\u5408\u5e76\uff0c\u4ece\u800c\u5927\u5e45\u5ea6\u51cf\u5c11\u78c1\u76d8\u6587\u4ef6\u7684\u6570\u91cf\uff0c\u8fdb\u800c\u63d0\u5347 shuffle write \u7684\u6027\u80fd\u3002"}),"\n",(0,n.jsxs)(s.p,{children:["\u5047\u8bbe\u7b2c\u4e8c\u4e2a stage \u6709 100 \u4e2a task\uff0c\u7b2c\u4e00\u4e2a stage \u6709 50 \u4e2a task\uff0c\u603b\u5171\u8fd8\u662f\u6709 10 \u4e2a Executor\uff08Executor CPU \u4e2a\u6570\u4e3a 1\uff09\uff0c\u6bcf\u4e2a Executor \u6267\u884c 5 \u4e2a task\u3002\u90a3\u4e48\u539f\u672c\u4f7f\u7528\u672a\u7ecf\u4f18\u5316\u7684 HashShuffleManager \u65f6\uff0c\u6bcf\u4e2a Executor \u4f1a\u4ea7\u751f 500 \u4e2a\u78c1\u76d8\u6587\u4ef6\uff0c\u6240\u6709 Executor \u4f1a\u4ea7\u751f 5000 \u4e2a\u78c1\u76d8\u6587\u4ef6\u7684\u3002\u4f46\u662f\u6b64\u65f6\u7ecf\u8fc7\u4f18\u5316\u4e4b\u540e\uff0c\u6bcf\u4e2a Executor \u521b\u5efa\u7684\u78c1\u76d8\u6587\u4ef6\u7684\u6570\u91cf\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1acpu core\u7684\u6570\u91cf * \u4e0b\u4e00\u4e2astage\u7684task\u6570\u91cf\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a Executor \u6b64\u65f6\u53ea\u4f1a\u521b\u5efa 100 \u4e2a\u78c1\u76d8\u6587\u4ef6\uff0c\u6240\u6709 Executor \u53ea\u4f1a\u521b\u5efa 1000 \u4e2a\u78c1\u76d8\u6587\u4ef6\u3002",(0,n.jsx)("br",{}),"\u8fd9\u4e2a\u529f\u80fd\u4f18\u70b9\u660e\u663e\uff0c\u4f46\u4e3a\u4ec0\u4e48 Spark \u4e00\u76f4\u6ca1\u6709\u5728\u57fa\u4e8e Hash Shuffle \u7684\u5b9e\u73b0\u4e2d\u5c06\u529f\u80fd\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u9009\u9879\u5462\uff0c\u5b98\u65b9\u7ed9\u51fa\u7684\u8bf4\u6cd5\u662f\u8fd9\u4e2a\u529f\u80fd\u8fd8\u6b20\u7a33\u5b9a\u3002",(0,n.jsx)("br",{}),"Consolidation\u7b97\u6cd5\u5c31\u662f\u591a\u4e86\u4e00\u4e2a\u6587\u4ef6\u7684\u5408\u5e76\uff0c \u4ece\u4e4b\u524d\u7684\u6bcf\u4e2aMapTask\u751f\u6210\u6587\u4ef6\u4f18\u5316\u4e3a\u6bcf\u4e2aExecotor\u4e3a\u5355\u4f4d\u751f\u6210\u6587\u4ef6(\u5176\u5b9e\u5e94\u8be5\u662f\u4ee5Core\u6838\u5fc3\u6570\u4e3a\u5355\u4f4d\uff0c\u8fd9\u91cc\u9ed8\u8ba4\u4e86\u4e00\u4e2aExecutor\u53ea\u6709\u4e00\u4e2aCore\u6838\u5fc3)\uff0c\u8fd9\u4e2a\u5408\u5e76\u5176\u5b9e\u662f\u6307\u5355\u5206\u533a\u7684\u5408\u5e76\uff0c\u6700\u7ec8\u4ee5\u4e00\u4e2a\u6587\u4ef6\u4e3a\u4e00\u4e2a\u5206\u533a\u3002",(0,n.jsx)("br",{}),"ConsolidatedShuffle \u4ee5Executor\u4e3a\u5355\u4f4d\uff0c\u8fdb\u884c\u6587\u4ef6\u5904\u7406\uff0c\u5982\u4e0b\u56fe\uff1a",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{alt:"img_1.png",src:r(3529).A+"",width:"750",height:"457"}),(0,n.jsx)("br",{}),"\u548c\u7b2c\u4e00\u7248\u4e0d\u540c\u7684\u662f\uff0c\u4ee5Executor\u4e3a\u5355\u4f4d\u751f\u6210\u5bf9\u5e94\u7684Task\u6587\u4ef6\uff0c\u8fd9\u6837\u7684\u8bddTask\u6587\u4ef6\u7684\u6570\u91cf\u5c31\u4f1a\u5927\u5e45\u7684\u51cf\u5c11\uff0c\u4e3aExecutor\u7684\u6570\u91cf*ReeuceTask\u7684\u6570\u91cf\u3002\u4f46\u662f\u5982\u679cReduceTask\u7684\u6570\u91cf\u4f9d\u7136\u8fd8\u662f\u6bd4\u8f83\u591a\u7684\u8bdd\uff0c \u4ea7\u751f\u7684task\u6587\u4ef6\u6570\u8fd8\u662f\u5f88\u591a\u3002 \u6700\u7ec8Spark\u8f6c\u5411\u4e86SortShuffer.",(0,n.jsx)("br",{}),"\u603b\u7ed3\uff1a"]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"HashShuffer\u7684\u4f18\u70b9\u662f\u4e0d\u7528\u6392\u5e8f\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u4e0b\u6e38Task\u7684\u6570\u636e\u90fd\u88ab\u5355\u72ec\u5199\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c \u6240\u4ee5\u53ef\u4ee5\u4e0d\u7528\u6392\u5e8f\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u7f3a\u70b9\u662f\u751f\u4ea7\u7684\u6587\u4ef6\u8fc7\u591a\uff0c\u4f1a\u5bf9\u6587\u4ef6\u7cfb\u7edf\u9020\u6210\u538b\u529b\u3002\u5927\u91cf\u5c0f\u6587\u4ef6\u968f\u673a\u8bfb\u5199\u5e26\u6765\u4e00\u5b9a\u7684\u78c1\u76d8\u5f00\u9500\u3002"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"sort-based-shuffer",children:"Sort Based Shuffer"}),"\n",(0,n.jsxs)(s.p,{children:["\u53c2\u8003\uff1a",(0,n.jsx)(s.a,{href:"https://blog.csdn.net/weixin_39216383/article/details/81194498",children:"https://blog.csdn.net/weixin_39216383/article/details/81194498"}),(0,n.jsx)("br",{}),"\u7531\u4e8eHashShuffer\u4f1a\u5bfc\u81f4\u4ea7\u751f\u5927\u91cf\u7684\u4e2d\u95f4\u78c1\u76d8\u6587\u4ef6\uff0c\u5bfc\u81f4IO\u6027\u80fd\u964d\u4f4e\u3002\u5c3d\u7ba1\u540e\u9762\u6709\u5408\u5e76\u6587\u4ef6\u7684HashShuffer\uff0c\u4f46\u662f\u5f53ReduceTask\u6570\u91cf\u5927\u7684\u65f6\u5019\u4f9d\u7136\u4f1aI\u4ea7\u751f\u5927\u91cf\u7684\u6587\u4ef6\u5bfc\u81f4IO\u6027\u80fd\u964d\u4f4e\u3002",(0,n.jsx)("br",{}),"\u56e0\u6b64Spark\u57281.2\u7248\u672c\u6b63\u5f0f\u4f7f\u7528\u4e86Sort Shuffer\u66ff\u4ee3\u4e86Hash Shuffer\u3002\u56e0\u6b64\u76ee\u524d\u6211\u4eec\u5728Spark\u4e2d\u4f7f\u7528\u5230\u7684Shuffer\u7b97\u6cd5\u90fd\u662fSort Base Shuffer\u3002",(0,n.jsx)("br",{}),"\u5728Sort Shuffer\u4e2d\uff0c\u5206\u4e24\u7c7b\u7684\u573a\u666f\uff0c\u4e00\u7c7b\u662f\u666e\u901a\u7684SortShuffer\uff0c\u4e00\u7c7b\u662f\u5f00\u542fbyPass\u7684Sort Shuffer\u3002\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f7f\u7528\u666e\u901aSortShuffer\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f7f\u7528ByPass\u7684Sort\u53d6\u51b3\u4e8e\u662f\u6709\u6ca1\u6709\u805a\u5408\u8fd0\u7b97\u3002",(0,n.jsx)("br",{}),(0,n.jsx)(s.strong,{children:"\u666e\u901aSortShuffer"}),(0,n.jsx)("br",{}),"\u4f1a\u5bf9partition\u4e2d\u6570\u636e\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u6392\u5e8f\u3002\u7136\u540e\u5206\u6279\u6b21\u5199\u5165\u5230\u78c1\u76d8\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\uff0c\u6700\u540e\u628a\u591a\u4e2a\u4e34\u65f6\u6587\u4ef6\u5408\u5e76\u4e3a\u4e00\u4e2a\u6587\u4ef6(\u591a\u5206\u533a\u6570\u636e\u5408\u5e76)\u3002\u8fd9\u79cd\u6a21\u5f0f\u548cMapreduce\u5dee\u4e0d\u591a\uff0c\u6570\u636e\u4f1a\u5148\u5199\u5165\u4e00\u4e2a\u5185\u5b58\u6570\u636e\u7ed3\u6784\u4e2d\uff0c\u5982\u679c\u662fReduceByKey\u8fd9\u79cd\u5e26\u6709\u805a\u5408\u7684\u7b97\u5b50\uff0c\u90a3\u4e48\u5185\u5b58\u7ed3\u6784\u4f1a\u4f7f\u7528Map\u7ed3\u6784\u3002\u5982\u679c\u662fJoin\u8fd9\u79cdshuffer\u7b97\u5b50\uff0c \u5219\u4f1a\u4f7f\u7528ArrayList\u7684\u6570\u636e\u7ed3\u6784\uff0c \u6570\u636e\u76f4\u63a5\u5199\u5165\u5185\u5b58\uff0c\u5f53\u5185\u5b58\u6570\u636e\u91cf\u8fbe\u5230\u4e34\u754c\u503c\u65f6\uff0c\u4f1a\u5c06\u5185\u5b58\u6570\u636e\u5199\u5165\u5230\u78c1\u76d8\u4e2d\u3002\u5728\u5199\u5165\u78c1\u76d8\u524d\uff0c\u4f1a\u6309key\u5bf9\u6bcf\u4e2apartition\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u6392\u5e8f\u540e\u6309\u6279\u6b21\u5199\u5165\u78c1\u76d8\u6587\u4ef6\uff0c \u6700\u540e\u518d\u8fdb\u884c\u5408\u5e76\u5230\u4e00\u4e2a\u6587\u4ef6\u3002\u56e0\u6b64\u4ea7\u751f\u7684\u6587\u4ef6\u6570\u91cf\u548cShuffer Write Task\u3002\u7684\u6570\u91cf\u76f8\u540c\u3002\u5982\u4e0b\u56fe\uff1a",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{src:"https://cdn.nlark.com/yuque/0/2023/jpeg/390265/1685340542432-2e9baa86-ea14-4b0b-b798-6f1793dbb31c.jpeg#averageHue=%23f0f085&clientId=u63baf342-ef31-4&from=paste&id=u726c43e6&originHeight=1084&originWidth=1308&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ufbd26bc4-2f5a-410f-b9fe-d5e2537c17c&title=",alt:""}),(0,n.jsx)("br",{}),(0,n.jsx)(s.strong,{children:"byPass\u673a\u5236\u7684SortShuffer(\u5ffd\u7565sort)"}),(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{src:"https://cdn.nlark.com/yuque/0/2023/jpeg/390265/1685340586141-27f7a003-301e-48bb-a4bd-442c16a3a16f.jpeg#averageHue=%23f2f276&clientId=u63baf342-ef31-4&from=paste&id=u91d5e5f0&originHeight=1102&originWidth=1714&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u16243c38-a0b0-4f09-b9d9-a0bdeace85a&title=",alt:""}),(0,n.jsx)("br",{}),"byPass\u7684\u542f\u52a8\u673a\u5236\uff1a"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"shuffle reduce task\u6570\u91cf\u5c0f\u4e8espark.shuffle.sort.bypassMergeThreshold\u53c2\u6570\u7684\u503c\uff0c\u8fd9\u4e2a\u503c\u9ed8\u8ba4200\u4e2a\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u4e0d\u662f\u805a\u5408\u7c7b\u7684shuffle\u7b97\u5b50\uff08\u6bd4\u5982reduceByKey\uff09\u3002"}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["byPass\u7684\u7279\u6b8a\u4e4b\u5904\u5728\u4e8e\u4e0d\u4f1a\u5bf9partition\u5185\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\u3002\u3001Reducer \u7aef\u4efb\u52a1\u6570\u6bd4\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u57fa\u4e8e Hash Shuffle \u5b9e\u73b0\u673a\u5236\u660e\u663e\u6bd4\u57fa\u4e8e Sort Shuffle \u5b9e\u73b0\u673a\u5236\u8981\u5feb\uff0c\u56e0\u6b64\u57fa\u4e8e Sort huffle \u5b9e\u73b0\u673a\u5236\u63d0\u4f9b\u4e86\u4e00\u4e2a\u56de\u9000\u65b9\u6848\uff0c\u5c31\u662f bypass \u8fd0\u884c\u673a\u5236\u3002\u5bf9\u4e8e Reducer \u7aef\u4efb\u52a1\u6570\u5c11\u4e8e\u914d\u7f6e\u5c5e\u6027spark.shuffle.sort.bypassMergeThreshold\u8bbe\u7f6e\u7684\u4e2a\u6570\u65f6\uff0c\u4f7f\u7528\u5e26 Hash \u98ce\u683c\u7684\u56de\u9000\u8ba1\u5212\u3002",(0,n.jsx)("br",{}),"\u6b64\u65f6\uff0c\u6bcf\u4e2a task \u4f1a\u4e3a\u6bcf\u4e2a\u4e0b\u6e38 task \u90fd\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u78c1\u76d8\u6587\u4ef6\uff0c\u5e76\u5c06\u6570\u636e\u6309 key \u8fdb\u884c hash \u7136\u540e\u6839\u636e key \u7684 hash \u503c\uff0c\u5c06 key \u5199\u5165\u5bf9\u5e94\u7684\u78c1\u76d8\u6587\u4ef6\u4e4b\u4e2d\u3002\u5f53\u7136\uff0c\u5199\u5165\u78c1\u76d8\u6587\u4ef6\u65f6\u4e5f\u662f\u5148\u5199\u5165\u5185\u5b58\u7f13\u51b2\uff0c\u7f13\u51b2\u5199\u6ee1\u4e4b\u540e\u518d\u6ea2\u5199\u5230\u78c1\u76d8\u6587\u4ef6\u7684\u3002\u6700\u540e\uff0c\u540c\u6837\u4f1a\u5c06\u6240\u6709\u4e34\u65f6\u78c1\u76d8\u6587\u4ef6\u90fd\u5408\u5e76\u6210\u4e00\u4e2a\u78c1\u76d8\u6587\u4ef6\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u7d22\u5f15\u6587\u4ef6\u3002",(0,n.jsx)("br",{}),"\u8be5\u8fc7\u7a0b\u7684\u78c1\u76d8\u5199\u673a\u5236\u5176\u5b9e\u8ddf\u672a\u7ecf\u4f18\u5316\u7684 HashShuffleManager \u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c\u56e0\u4e3a\u90fd\u8981\u521b\u5efa\u6570\u91cf\u60ca\u4eba\u7684\u78c1\u76d8\u6587\u4ef6\uff0c\u53ea\u662f\u5728\u6700\u540e\u4f1a\u505a\u4e00\u4e2a\u78c1\u76d8\u6587\u4ef6\u7684\u5408\u5e76\u800c\u5df2\u3002\u56e0\u6b64\u5c11\u91cf\u7684\u6700\u7ec8\u78c1\u76d8\u6587\u4ef6\uff0c\u4e5f\u8ba9\u8be5\u673a\u5236\u76f8\u5bf9\u672a\u7ecf\u4f18\u5316\u7684 HashShuffleManager \u6765\u8bf4\uff0cshuffle read \u7684\u6027\u80fd\u4f1a\u66f4\u597d\u3002",(0,n.jsx)("br",{}),"\u800c\u8be5\u673a\u5236\u4e0e\u666e\u901a SortShuffleManager \u8fd0\u884c\u673a\u5236\u7684\u4e0d\u540c\u5728\u4e8e\uff1a\u7b2c\u4e00\uff0c\u78c1\u76d8\u5199\u673a\u5236\u4e0d\u540c\uff1b\u7b2c\u4e8c\uff0c\u4e0d\u4f1a\u8fdb\u884c\u6392\u5e8f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u542f\u7528\u8be5\u673a\u5236\u7684\u6700\u5927\u597d\u5904\u5728\u4e8e\uff0cshuffle write \u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u6570\u636e\u7684\u6392\u5e8f\u64cd\u4f5c\uff0c\u4e5f\u5c31\u8282\u7701\u6389\u4e86\u8fd9\u90e8\u5206\u7684\u6027\u80fd\u5f00\u9500\u3002",(0,n.jsx)("br",{}),(0,n.jsx)(s.strong,{children:"\u603b\u7ed3:"})]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"\u5982\u679c\u6709\u805a\u5408\u6761\u4ef6\u7684Shuffer\u7b97\u5b50(\u6bd4\u5982ReduceByKey)\uff0c\u4f7f\u7528\u666e\u901a\u673a\u5236\u7684SortShuffer\uff0c\u4f1a\u8fdb\u884c\u6392\u5e8f"}),"\n",(0,n.jsx)(s.li,{children:"\u5982\u679c\u4e0d\u662f\u805a\u5408\u6761\u4ef6\u7684Shuffer\u7b97\u5b50\uff0c\u4e14Shuffer Read Task\u7684\u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8espark.shuffle.sort.bypassMergeThreshold\u7684\u503c(\u9ed8\u8ba4\u4e3a200)\uff0c\u5c31\u4f1a\u542f\u7528byPass\u673a\u5236\uff0cbyPass\u4e0d\u4f1a\u8fdb\u884c\u6392\u5e8f\u3002\u53ef\u4ee5\u51cf\u5c11\u6392\u5e8f\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u4e24\u79cdSortShuffer\u4ea7\u751f\u7684task\u6587\u4ef6\u6570\u91cf\u548cMap Task \u7684\u6570\u91cf\u76f8\u540c\u3002 \u4e0eReduceTask\u6570\u91cf\u6ca1\u6709\u5173\u7cfb\u3002\u6bd4\u59822\u4e2aExecutor\uff0c\u6bcf\u4e2aExecutor\u4e2d\u67092\u4e2aMapTask\u3002\u90a3\u4e48\u5c31\u4f1a\u4ea7\u751f4\u4e2atask\u6587\u4ef6 \uff0c\u8fd9\u4e2a\u6587\u4ef6\u662f\u5c06\u4e0b\u6e38\u5206\u533a\u7684\u6570\u636eMerge\u4e00\u8d77\u4e86\u3002\u5e76\u5e26\u6709\u4e00\u4e2a\u7d22\u5f15\u6587\u4ef6\uff0cReduce\u7aef\u62c9\u53d6\u7684\u65f6\u5019\u4f1a\u5148\u901a\u8fc7\u7d22\u5f15\u6587\u4ef6\u786e\u5b9a\u8981\u8bfb\u53d6\u7684\u6587\u4ef6\u7684\u6570\u636e\u8303\u56f4\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u4e3a\u4ec0\u4e48HashShuffer\u4e2d\u6ca1\u6709\u8fdb\u884csort,\u662f\u4e3a\u4e86\u53bb\u6389sort\u8fd9\u4e2a\u9636\u6bb5\uff0c\u5982\u679c\u6ca1\u6709\u4e86sort\uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740\u6700\u7ec8\u751f\u6210\u7684\u591a\u4e2a\u6587\u4ef6\u4e0d\u80fd\u5408\u5e76\uff0cMapReduce\u4e2dshuffer\u662f\u7528\u5f52\u5e76\u6392\u5e8f\uff0c\u524d\u63d0\u662f\u6bcf\u4e2a\u6587\u4ef6\u4e2d\u5df2\u7ecf\u505a\u4e86\u6392\u5e8f\u3002\u4f46\u662fspark\u6ca1\u6709sort\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u6587\u4ef6\u5408\u5e76\u6210\u672c\u5f88\u9ad8\uff0c\u57fa\u672c\u5c31\u4e0d\u53ef\u80fd\u5408\u5e76\u3002\u6240\u4ee5Map Task \u5bf9\u4e0b\u6e38\u7684\u6bcf\u4e2aReduce\u5355\u72ec\u751f\u6210\u4e86\u4e00\u4e2apartition\u4e86\u3002\u80fd\u591f\u5408\u5e76\u7684\u524d\u63d0\u662f\u6309\u4e00\u4e2a\u6587\u4ef6\u4e2d\u8981\u6309partition\u6392\u5e8f\uff0c\u8fd9\u6837reduce\u6b63\u786e\u62c9\u53d6\u5230\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u5728\u7b2c\u4e8c\u7248\u7684HashShuffer\u4e2d\uff0c\u5bf9Map Task \u751f\u6210\u7684\u6587\u4ef6\u8fdb\u884c\u4e86\u5408\u5e76\uff0c\u5408\u5e76\u89c4\u5219\u662f\u6309\u7167partition\u8fdb\u884c\u5408\u5e76\uff0c\u6700\u7ec8\u5728\u4e00\u4e2aExecutor\u4e2d\u7684\u6587\u4ef6\u4e2a\u6570\u4e0eReduce\u7684\u6570\u91cf\u662f\u4e00\u81f4\u7684\u3002\u4e00\u4e2a\u5206\u533a\u4e00\u4e2a\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,n.jsxs)(s.h2,{id:"\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b",children:["\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b",(0,n.jsx)("br",{}),(0,n.jsx)("br",{})]}),"\n",(0,n.jsx)(s.h2,{id:"\u6570\u636e\u503e\u659c",children:"\u6570\u636e\u503e\u659c"}),"\n",(0,n.jsx)(s.h3,{id:"\u4ec0\u4e48\u662f\u6570\u636e\u503e\u659c",children:"\u4ec0\u4e48\u662f\u6570\u636e\u503e\u659c"}),"\n",(0,n.jsx)(s.p,{children:"\u6570\u636e\u6e05\u6d17\u662f\u67d0\u4e2apartitin\u7684\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c \u800c\u522b\u7684\u5206\u533a\u7684\u6570\u636e\u91cf\u5c0f\u3002\u5bfc\u81f4\u51e0\u4e2atask\u8ba1\u7b97\u8017\u65f6\u5f88\u4e45\u4efb\u52a1\u8ba1\u7b97\u65f6\u95f4\u5f88\u957f\u3002\u5c31\u662f\u67d0\u4e2akey\u5728shuffer\u7684\u65f6\u5019\u88ab\u5206\u53d1\u5230\u4e00\u4e2a\u5206\u533a\uff0c\u800c\u8fd9\u4e2akey\u7684\u6570\u91cf\u8fdc\u5927\u4e8e\u5176\u4ed6\u7684key."}),"\n",(0,n.jsx)(s.h3,{id:"\u6570\u636e\u503e\u659c\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898",children:"\u6570\u636e\u503e\u659c\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"\u5bfc\u81f4OOM"}),"\n",(0,n.jsx)(s.li,{children:"\u5bfc\u81f4\u4efb\u52a1\u8ba1\u7b97\u65f6\u95f4\u5f88\u957f"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"\u5982\u4f55\u89e3\u51b3\u6570\u636e\u503e\u659c",children:"\u5982\u4f55\u89e3\u51b3\u6570\u636e\u503e\u659c"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["\u53c2\u8003\uff1a ",(0,n.jsx)(s.a,{href:"https://zhuanlan.zhihu.com/p/511193855",children:"https://zhuanlan.zhihu.com/p/511193855"})]}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"\u57fa\u672c\u601d\u8def",children:"\u57fa\u672c\u601d\u8def"}),"\n",(0,n.jsx)(s.p,{children:"\u65e2\u7136\u6570\u636e\u503e\u659c\u662f\u56e0\u4e3a\u76f8\u540c key \u7684\u503c\u88ab\u5206\u914d\u5230\u5c11\u6570\u51e0\u4e2a\u8282\u70b9\u4e0a\u9020\u6210\u7684\u5355\u70b9\u95ee\u9898\uff0c\u90a3\u4e48\u5c3d\u53ef\u80fd\u7684\u7684\u8ba9 key \u5e73\u5747\u5206\u914d\uff0c\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002\u6240\u4ee5\u53ef\u4ee5\u6709\u51e0\u4e2a\u601d\u8def\uff1a"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"\u6570\u636e\u9884\u5904\u7406\uff1a\u5728\u6570\u636e\u6e05\u6d17\u8fc7\u7a0b\u4e2d\u628a\u8ba1\u6570\u7279\u522b\u591a\u7684 key \u8fc7\u6ee4\u6389\uff08\u6709\u635f\uff09\uff0c\u6216\u5355\u72ec\u8ba1\u7b97\uff08\u65e0\u635f\uff09\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u4e1a\u52a1\u903b\u8f91\u4f18\u5316\uff1a\u4ece\u4e1a\u52a1\u903b\u8f91\u7684\u5c42\u9762\u4e0a\u6765\u4f18\u5316\u6570\u636e\u503e\u659c\uff0c\u6bd4\u5982\u4ece\u6570\u636e\u7684\u6e90\u5934\u5c31\u5c3d\u53ef\u80fd\u907f\u514d\u5355\u4e2a\u8ba1\u91cf\u5f88\u5927\u7684 key"}),"\n",(0,n.jsx)(s.li,{children:"\u53c2\u6570\u4f18\u5316\uff1aHadoop \u548c Spark \u90fd\u81ea\u5e26\u4e86\u5f88\u591a\u7684\u53c2\u6570\u548c\u673a\u5236\u6765\u8c03\u8282\u6570\u636e\u503e\u659c\uff0c\u5408\u7406\u5229\u7528\u5b83\u4eec\u5c31\u80fd\u89e3\u51b3\u5927\u90e8\u5206\u95ee\u9898\u3002"}),"\n",(0,n.jsx)(s.li,{children:"\u7a0b\u5e8f\u4f18\u5316\uff1a\u6bd4\u5982\u7528 group \u4ee3\u66ff count(distinct) \u7b49\u3002"}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"\u8fc7\u6ee4\u5f02\u5e38\u6570\u636e",children:"\u8fc7\u6ee4\u5f02\u5e38\u6570\u636e"}),"\n",(0,n.jsxs)(s.p,{children:["\u76f4\u63a5\u8fc7\u6ee4\u5f02\u5e38\u6570\u636e\uff0c\u5bf9\u4e8e\u6709\u7684\u60c5\u51b5\u4e0b\u662f\u6709\u635f\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u90e8\u5206\u60c5\u51b5\uff0c\u8be5\u65b9\u6cd5\u4e5f\u662f\u53ef\u7528\u7684\uff0c\u6bd4\u5982\u672c\u8be5\u5728\u6570\u636e\u6e05\u6d17\u9636\u6bb5\u6e05\u6d17\u7684\u5927\u91cf\u7684NULL\u503c\u3001\u7a7a\u503c\u672a\u88ab\u6e05\u6d17\u3002\u5bf9\u4e8e\u8fd9\u7c7b\u60c5\u51b5\uff0c\u76f4\u63a5\u4f7f\u7528 where \u6761\u4ef6\u8fc7\u6ee4\u5373\u53ef\u3002",(0,n.jsx)("br",{}),"\u53e6\u5916\uff0c\u5982\u679c\u90e8\u5206\u770b\u8d77\u6765\u6709\u7528\u7684\u6570\u636e\uff0c\u4f46\u662f\u9884\u4f30\u5230\u5b9e\u9645\u8ba1\u7b97\u7ed3\u679c\u4e2d\u5f71\u54cd\u4e0d\u5927\uff0c\u4e5f\u53ef\u914c\u60c5\u8fc7\u6ee4\u3002"]}),"\n",(0,n.jsx)(s.h4,{id:"\u4f18\u5316\u5143\u6570\u636e",children:"\u4f18\u5316\u5143\u6570\u636e"}),"\n",(0,n.jsx)(s.h4,{id:"\u4f18\u5316map\u7aef\u6570\u636e",children:"\u4f18\u5316Map\u7aef\u6570\u636e"}),"\n",(0,n.jsx)(s.p,{children:"\u5982\u679cMap\u7aef\u4eceHDFS\u8bfb\u53d6\u7684\u6570\u636e\u4e3a\u4e0d\u538b\u7f29\u6587\u4ef6\uff0c\u4e14\u4e0d\u652f\u6301split\u5207\u5272\uff0c\u5219\u4f1a\u5bfc\u81f4\u6709\u7684Map\u7aef\u8bfb\u53d6\u7684\u6587\u4ef6\u6bd4\u8f83\u5927\uff0c\u6709\u7684\u6587\u4ef6\u8bfb\u53d6\u7684\u6587\u4ef6\u8f83\u5c0f\u3002\u4ea7\u751fMap\u7aef\u7684\u6570\u636e\u503e\u659c\u3002"}),"\n",(0,n.jsx)(s.h4,{id:"\u4f18\u5316shuffle\u903b\u8f91",children:"\u4f18\u5316Shuffle\u903b\u8f91"}),"\n",(0,n.jsx)(s.h4,{id:"\u4f7f\u7528mapjoin",children:"\u4f7f\u7528MapJoin"}),"\n",(0,n.jsx)(s.h4,{id:"\u8c03\u6574reduce\u5e76\u884c\u5ea6",children:"\u8c03\u6574reduce\u5e76\u884c\u5ea6"}),"\n",(0,n.jsx)(s.p,{children:"\u8c03\u6574reduce\u7684\u5e76\u884c\u5ea6\uff0c\u4ece\u800c\u4f7f\u5f97\u6bcf\u4e2apartition\u5206\u533a\u5206\u53d1\u5230\u7684\u6570\u636e\u91cf\u4f1a\u51cf\u5c11\u3002\u4ece\u800c\u89e3\u51b3\u6570\u636e\u503e\u659c\u3002"}),"\n",(0,n.jsx)(s.h4,{id:"key-\u52a0\u76d0",children:"key \u52a0\u76d0"}),"\n",(0,n.jsx)(s.h2,{id:"checkpoint",children:"Checkpoint"}),"\n",(0,n.jsx)(s.h2,{id:"\u7f13\u5b58",children:"\u7f13\u5b58"}),"\n",(0,n.jsxs)(s.p,{children:["RDD \u53ef\u4ee5\u4f7f\u7528 persist() \u65b9\u6cd5\u6216 cache() \u65b9\u6cd5\u8fdb\u884c\u6301\u4e45\u5316\u3002\u6570\u636e\u5c06\u4f1a\u5728\u7b2c\u4e00\u6b21 action \u64cd\u4f5c\u65f6\u8fdb\u884c\u8ba1\u7b97\uff0c\u5e76\u7f13\u5b58\u5728\u8282\u70b9\u7684\u5185\u5b58\u4e2d\u3002Spark \u7684\u7f13\u5b58\u5177\u6709\u5bb9\u9519\u673a\u5236\uff0c\u5982\u679c\u4e00\u4e2a\u7f13\u5b58\u7684 RDD \u7684\u67d0\u4e2a\u5206\u533a\u4e22\u5931\u4e86\uff0cSpark \u5c06\u6309\u7167\u539f\u6765\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u81ea\u52a8\u91cd\u65b0\u8ba1\u7b97\u5e76\u8fdb\u884c\u7f13\u5b58\u3002",(0,n.jsx)("br",{}),"\u6301\u4e45\u5316\u662f\u5c06RDD\u7684\u6570\u636e\u7f13\u5b58\u5230\u5185\u5b58\u6216\u8005\u5176\u4ed6\u5b58\u50a8\u4ecb\u8d28\u4e2d(\u6bd4\u5982\u78c1\u76d8)\u3002",(0,n.jsx)("br",{}),"RDD\u672c\u8eab\u662f\u4e0d\u5b58\u50a8\u6570\u636e\u7684\uff0c\u5982\u679c\u8981\u60f3\u4e00\u4e2aRDD\u5b9e\u73b0\u590d\u7528\uff0c\u5219\u4f1a\u91cd\u65b0\u4ece\u6e90\u5934\u5f00\u59cb\u8ba1\u7b97\u6570\u636e\u3002\u5bfc\u81f4\u6570\u636e\u88ab\u91cd\u65b0\u8ba1\u7b97\u3002",(0,n.jsx)("br",{}),"\u5982\u679c\u4e00\u4e2aRDD\u7f13\u5b58\u7684\u6570\u636e\u4e22\u5931\u4e86\uff0c\u5219\u4f1a\u91cd\u65b0\u8ba1\u7b97\u6570\u636e\u3002"]}),"\n",(0,n.jsx)(s.h3,{id:"cache",children:"Cache"}),"\n",(0,n.jsxs)(s.p,{children:["Cache\u548cPersist\u65b9\u6cd5\u5176\u5b9e\u8868\u8fbe\u7684\u662f\u540c\u4e00\u4e2a\u610f\u601d\uff0c\u53ea\u4e0d\u8fc7Cache\u65b9\u6cd5\u4e5f\u8c03\u7528\u7684\u662fpersist\u65b9\u6cd5\u3002",(0,n.jsx)("br",{}),"Cache\u5bf9\u67d0\u4e2aRDD\u7684\u6570\u636e\u8fdb\u884c\u7f13\u51b2\u5230\u5185\u5b58\u4e2d\uff0c\u5b9e\u73b0\u4e86\u6570\u636e\u7684\u590d\u7528\u3002\u4e0b\u6b21\u91cd\u590d\u4f7f\u7528\u8be5RDD\u7684\u65f6\u5019\u4e0d\u4f1a\u4ece\u6570\u636e\u6e90\u8fdb\u884c\u91cd\u65b0\u7684\u8ba1\u7b97\uff0c\u63d0\u9ad8\u4e86\u8ba1\u7b97\u6548\u7387\u548c\u51cf\u5c11\u4e86\u91cd\u590d\u7684\u8ba1\u7b97\u91cf\u3002",(0,n.jsx)("br",{}),"\u6e90\u4ee3\u7801\u5982\u4e0b\uff0c\u5176\u5b9ecache\u8fd8\u662f\u8c03\u7528\u4e86persist()\u7684\u65e0\u53c2\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\u3002"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-scala",children:"def persist(): this.type = persist(StorageLevel.MEMORY_ONLY)\n\n/**\n* Persist this RDD with the default storage level (`MEMORY_ONLY`).\n*/\ndef cache(): this.type = persist()\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-scala",children:'package com.dytg.sparkcore\n\nimport org.apache.spark.{SparkConf, SparkContext}\n\nobject Cache01 {\n\n  def main(args: Array[String]): Unit = {\n\n    val sparkConf = new SparkConf().setAppName("Example021").setMaster("local[*]")\n\n    val sc = new SparkContext(sparkConf)\n\n    val rdd = sc.makeRDD(List("zhangsan", "lisi", "wangwu"));\n\n    val mapRdd = rdd.map(e =>{\n      println("\u6267\u884cmap \u7b97\u5b50")\n      e+" : 20 "\n    } )\n\n    mapRdd.cache()\n\n    mapRdd.foreach(e => println(e))\n\n    //\u5982\u679c\u5bf9maprdd\u4e0d\u8fdb\u884ccache\u7f13\u5b58\uff0c\u90a3\u4e48\u6267\u884csaveAsTextFile\u65f6\u4f1a\u987a\u7740RDD\u8840\u7f18\u91cd\u65b0\u518d\u8ba1\u7b97\u4e00\u6b21\u3002\n    //\u867d\u7136\u8fd9\u91ccmapRDD\u8fd9\u4e2a\u5bf9\u8c61\u88ab\u590d\u7528\u4e86\uff0c\u4f46\u662fRDD\u4e2d\u672c\u8eab\u662f\u4e0d\u5b58\u50a8\u6570\u636e\u7684\uff0c\u53ea\u662f\u5bf9\u6570\u636e\u7684\u62bd\u8c61\u7684\u63cf\u8ff0\u548c\u5b9a\u4e49\u3002\n    //\u6240\u4ee5\u9700\u8981\u8ffd\u6eaf\u5230\u6570\u636e\u6e90\u5934\u518d\u8fdb\u884c\u4e00\u6b21\u8ba1\u7b97\u3002\n    //\u5f53mapRdd\u6267\u884c\u4e86cache\uff0c\u5219\u4f1a\u5c06\u6570\u636e\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u518d\u4e00\u6b21\u4f7f\u7528mapRDD\u7684\u65f6\u5019\uff0c\u5c31\u76f4\u63a5\u4f7f\u7528cache\u7684\u6570\u636e\uff0c\u4e0d\u7528\u91cd\u65b0\u5f00\u59cb\u8ba1\u7b97\u4e86\uff0c\u8fd9\u662f\u4e00\u79cd\u51cf\u5c11\n    //\u91cd\u590d\u8ba1\u7b97\u91cf\u7684\u4e00\u79cd\u65b9\u6cd5\n    mapRdd.saveAsTextFile("rdd.txt")\n\n  }\n}\n'})}),"\n",(0,n.jsx)(s.h3,{id:"persist",children:"Persist"}),"\n",(0,n.jsx)(s.p,{children:"persist\u65b9\u6cd5\u7684\u4f5c\u7528\u548ccache\u65b9\u6cd5\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7persist\u65b9\u6cd5\u652f\u6301\u914d\u7f6e\u6570\u636e\u5b58\u50a8\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5b58\u50a8\u5230\u6587\u4ef6\u4e2d\uff0c\u4f46\u662f\u8fd9\u91cc\u7684\u5b58\u50a8\u5230\u6587\u4ef6\u4e2d\u662f\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u5f53Job\u505c\u6b62\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u5220\u9664\u8fd9\u4e2a\u4e34\u65f6\u7684\u6587\u4ef6\u3002\u56e0\u6b64\u53ea\u5728\u4e00\u4e2aJob\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4f7f\u7528\u5230\u3002"}),"\n",(0,n.jsx)(s.h3,{id:"\u5b58\u50a8\u7ea7\u522b",children:"\u5b58\u50a8\u7ea7\u522b"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"MEMORY_ONLY : \u5c06 RDD \u4ee5\u53cd\u5e8f\u5217\u5316 Java \u5bf9\u8c61\u7684\u5f62\u5f0f\u5b58\u50a8\u5728 JVM \u4e2d\u3002\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\uff0c\u90e8\u5206\u6570\u636e\u5206\u533a\u5c06\u4e0d\u518d\u7f13\u5b58\uff0c\u5728\u6bcf\u6b21\u9700\u8981\u7528\u5230\u8fd9\u4e9b\u6570\u636e\u65f6\u91cd\u65b0\u8fdb\u884c\u8ba1\u7b97\u3002\u8fd9\u662f\u9ed8\u8ba4\u7684\u7ea7\u522b\u3002"}),"\n",(0,n.jsx)(s.li,{children:"MEMORY_AND_DISK : \u5c06 RDD \u4ee5\u53cd\u5e8f\u5217\u5316 Java \u5bf9\u8c61\u7684\u5f62\u5f0f\u5b58\u50a8\u5728 JVM \u4e2d\u3002\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\uff0c\u5c06\u672a\u7f13\u5b58\u7684\u6570\u636e\u5206\u533a\u5b58\u50a8\u5230\u78c1\u76d8\uff0c\u5728\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u5206\u533a\u65f6\u4ece\u78c1\u76d8\u8bfb\u53d6\u3002"}),"\n",(0,n.jsx)(s.li,{children:"MEMORY_ONLY_SER : \u5c06 RDD \u4ee5\u5e8f\u5217\u5316\u7684 Java \u5bf9\u8c61\u7684\u5f62\u5f0f\u8fdb\u884c\u5b58\u50a8\uff08\u6bcf\u4e2a\u5206\u533a\u4e3a\u4e00\u4e2a byte \u6570\u7ec4\uff09\u3002\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u6bd4\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u65b9\u5f0f\u8282\u7701\u5f88\u591a\u7a7a\u95f4\uff0c\u5c24\u5176\u662f\u5728\u4f7f\u7528 fast serializer\u65f6\u4f1a\u8282\u7701\u66f4\u591a\u7684\u7a7a\u95f4\uff0c\u4f46\u662f\u5728\u8bfb\u53d6\u65f6\u4f1a\u589e\u52a0 CPU \u7684\u8ba1\u7b97\u8d1f\u62c5\u3002"}),"\n",(0,n.jsx)(s.li,{children:"MEMORY_AND_DISK_SER : \u7c7b\u4f3c\u4e8e MEMORY_ONLY_SER \uff0c\u4f46\u662f\u6ea2\u51fa\u7684\u5206\u533a\u4f1a\u5b58\u50a8\u5230\u78c1\u76d8\uff0c\u800c\u4e0d\u662f\u5728\u7528\u5230\u5b83\u4eec\u65f6\u91cd\u65b0\u8ba1\u7b97\u3002"}),"\n",(0,n.jsx)(s.li,{children:"DISK_ONLY : \u53ea\u5728\u78c1\u76d8\u4e0a\u7f13\u5b58 RDD\u3002"}),"\n",(0,n.jsx)(s.li,{children:"MEMORY_ONLY_2\uff0cMEMORY_AND_DISK_2\uff0c\u7b49\u7b49 : \u4e0e\u4e0a\u9762\u7684\u7ea7\u522b\u529f\u80fd\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u4e2a\u5206\u533a\u5728\u96c6\u7fa4\u4e2d\u4e24\u4e2a\u8282\u70b9\u4e0a\u5efa\u7acb\u526f\u672c\u3002"}),"\n",(0,n.jsx)(s.li,{children:"OFF_HEAP\uff08\u5b9e\u9a8c\u4e2d\uff09: \u7c7b\u4f3c\u4e8e MEMORY_ONLY_SER \uff0c\u4f46\u662f\u5c06\u6570\u636e\u5b58\u50a8\u5728 off-heap memory\uff0c\u8fd9\u9700\u8981\u542f\u52a8 off-heap \u5185\u5b58\u3002"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"\u7f13\u5b58\u5220\u9664\u7b56\u7565",children:"\u7f13\u5b58\u5220\u9664\u7b56\u7565"}),"\n",(0,n.jsx)(s.p,{children:"Spark \u81ea\u52a8\u76d1\u63a7\u5404\u4e2a\u8282\u70b9\u4e0a\u7684\u7f13\u5b58\u4f7f\u7528\u7387\uff0c\u5e76\u4ee5\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u65b9\u5f0f\uff08LRU\uff09\u5c06\u65e7\u6570\u636e\u5757\u79fb\u9664\u5185\u5b58\u3002\u5982\u679c\u60f3\u624b\u52a8\u79fb\u9664\u4e00\u4e2a RDD\uff0c\u800c\u4e0d\u662f\u7b49\u5f85\u8be5 RDD \u88ab Spark \u81ea\u52a8\u79fb\u9664\uff0c\u53ef\u4ee5\u4f7f\u7528 RDD.unpersist() \u65b9\u6cd5\u3002"}),"\n",(0,n.jsx)(s.h2,{id:"\u7d2f\u52a0\u5668\u548c\u5e7f\u64ad\u53d8\u91cf",children:"\u7d2f\u52a0\u5668\u548c\u5e7f\u64ad\u53d8\u91cf"}),"\n",(0,n.jsx)(s.h3,{id:"\u7d2f\u52a0\u5668",children:"\u7d2f\u52a0\u5668"}),"\n",(0,n.jsxs)(s.p,{children:["\u5728spark\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u6709\u8fd9\u6837\u7684\u9700\u6c42\uff0c\u5982\u5f02\u5e38\u76d1\u63a7\uff0c\u8c03\u8bd5\uff0c\u8bb0\u5f55\u7b26\u5408\u67d0\u7279\u6027\u7684\u6570\u636e\u7684\u6570\u76ee\uff0c\u8fd9\u79cd\u9700\u6c42\u90fd\u9700\u8981\u7528\u5230\u8ba1\u6570\u5668\uff0c\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u4e0d\u88ab\u58f0\u660e\u4e3a\u4e00\u4e2a\u7d2f\u52a0\u5668\uff0c\u90a3\u4e48\u5b83\u5c06\u5728\u88ab\u6539\u53d8\u65f6\u4e0d\u4f1a\u518ddriver\u7aef\u8fdb\u884c\u5168\u5c40\u6c47\u603b\uff0c\u5373\u5728\u5206\u5e03\u5f0f\u8fd0\u884c\u65f6\u6bcf\u4e2atask\u8fd0\u884c\u7684\u53ea\u662f\u539f\u59cb\u53d8\u91cf\u7684\u4e00\u4e2a\u526f\u672c\uff0c\u5e76\u4e0d\u80fd\u6539\u53d8\u539f\u59cb\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u662f\u5f53\u8fd9\u4e2a\u53d8\u91cf\u88ab\u58f0\u660e\u4e3a\u7d2f\u52a0\u5668\u540e\uff0c\u8be5\u53d8\u91cf\u5c31\u4f1a\u6709\u5206\u5e03\u5f0f\u8ba1\u6570\u7684\u529f\u80fd\u3002",(0,n.jsx)("br",{}),"\u9519\u8bef\u7684\u56fe\u89e3\uff1a",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{alt:"img_2.png",src:r(6946).A+"",width:"750",height:"287"}),(0,n.jsx)("br",{}),"\u6b63\u786e\u7684\u56fe\u89e3",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{alt:"img_3.png",src:r(7451).A+"",width:"750",height:"261"}),(0,n.jsx)("br",{}),"\u6ce8\u610f\u4e8b\u9879\uff1a",(0,n.jsx)("br",{}),"\u7d2f\u52a0\u5668\u5728Driver\u7aef\u5b9a\u4e49\u8d4b\u521d\u59cb\u503c\uff0c\u7d2f\u52a0\u5668\u53ea\u80fd\u5728Driver\u7aef\u8bfb\u53d6\u6700\u540e\u7684\u503c\uff0c\u5728Excutor\u7aef\u66f4\u65b0",(0,n.jsx)("br",{}),"\u7d2f\u52a0\u5668\u7684\u5b9a\u4e49"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"val a = sc.accumulator(0) //\u5b9a\u4e49\u4e00\u4e2a\u7d2f\u52a0\u5668\nval b = a.value //\u83b7\u53d6\u4e00\u4e2a\u7d2f\u52a0\u5668\u7684\u503c\n"})}),"\n",(0,n.jsx)(s.h3,{id:"\u5e7f\u64ad\u53d8\u91cf",children:"\u5e7f\u64ad\u53d8\u91cf"}),"\n",(0,n.jsxs)(s.p,{children:["\u5982\u679c\u6211\u4eec\u8981\u5728\u5206\u5e03\u5f0f\u8ba1\u7b97\u91cc\u9762\u5206\u53d1\u5927\u5bf9\u8c61\uff0c\u4f8b\u5982\uff1a\u5b57\u5178\uff0c\u96c6\u5408\uff0c\u9ed1\u767d\u540d\u5355\u7b49\uff0c\u8fd9\u4e2a\u90fd\u4f1a\u7531Driver\u7aef\u8fdb\u884c\u5206\u53d1\uff0c\u4e00\u822c\u6765\u8bb2\uff0c\u5982\u679c\u8fd9\u4e2a\u53d8\u91cf\u4e0d\u662f\u5e7f\u64ad\u53d8\u91cf\uff0c\u90a3\u4e48\u6bcf\u4e2atask\u5c31\u4f1a\u5206\u53d1\u4e00\u4efd\uff0c\u8fd9\u5728task\u6570\u76ee\u5341\u5206\u591a\u7684\u60c5\u51b5\u4e0bDriver\u7684\u5e26\u5bbd\u4f1a\u6210\u4e3a\u7cfb\u7edf\u7684\u74f6\u9888\uff0c\u800c\u4e14\u4f1a\u5927\u91cf\u6d88\u8017task\u670d\u52a1\u5668\u4e0a\u7684\u8d44\u6e90\uff0c\u5982\u679c\u5c06\u8fd9\u4e2a\u53d8\u91cf\u58f0\u660e\u4e3a\u5e7f\u64ad\u53d8\u91cf\uff0c\u90a3\u4e48\u77e5\u8bc6\u6bcf\u4e2aexecutor\u62e5\u6709\u4e00\u4efd\uff0c\u8fd9\u4e2aexecutor\u542f\u52a8\u7684task\u4f1a\u5171\u4eab\u8fd9\u4e2a\u53d8\u91cf\uff0c\u8282\u7701\u4e86\u901a\u4fe1\u7684\u6210\u672c\u548c\u670d\u52a1\u5668\u7684\u8d44\u6e90\u3002",(0,n.jsx)("br",{}),(0,n.jsx)(s.strong,{children:"\u5e7f\u64ad\u53d8\u91cf\u7684\u7279\u70b9"})]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"\u7531Driver\u7aef\u5206\u53d1\u5230\u6bcf\u4e2aExecutor\u4e0a"}),"\n",(0,n.jsx)(s.li,{children:"\u6bcf\u4e2aExecutor\u4e0a\u7684task\u5171\u4eab\u8bfb\u53d6\u8be5\u5e7f\u64ad\u53d8\u91cf"}),"\n",(0,n.jsx)(s.li,{children:"\u5e7f\u64ad\u53d8\u91cf\u4e0d\u80fd\u88ab\u4fee\u6539"}),"\n",(0,n.jsx)(s.li,{children:"\u4e00\u822c\u7528\u4e8e\u5b57\u5178\u8868\uff0c\u6216\u8005join\u5c0f\u8868\u7684\u5e7f\u64ad"}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u5e7f\u64ad\u53d8\u91cf\u56fe\u89e3",(0,n.jsx)("br",{}),"\u9519\u8bef\u7528\u6cd5\uff0c\u4f1a\u5bfc\u81f4\u6bcf\u4e2atask\u90fd\u6709\u4e00\u4efd\u53d8\u91cf\u7684\u6570\u636e\uff0c\u5bfc\u81f4\u6d6a\u8d39Executor\u7684\u5185\u5b58",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{alt:"img_4.png",src:r(7540).A+"",width:"750",height:"333"}),(0,n.jsx)("br",{}),"\u6b63\u786e\u7528\u6cd5\u3002\u4f7f\u7528\u5e7f\u64ad\u53d8\u91cf\u5206\u53d1\u5230\u6bcf\u4e2aExecutor\u4e0a\uff0cExecutor\u4e0a\u7684task\u5171\u4eab\u8be5\u53d8\u91cf\uff0c\u53d8\u91cf\u5185\u5b58\u53ea\u6709\u4e00\u4efd",(0,n.jsx)("br",{}),(0,n.jsx)(s.img,{alt:"img_5.png",src:r(8669).A+"",width:"750",height:"337"}),(0,n.jsx)("br",{}),"\u4e0b\u9762\u662f\u4e00\u4e2a\u4ee3\u7801\u793a\u4f8b\uff1a",(0,n.jsx)("br",{}),"\u8981\u901a\u8fc7broast.value\u6765\u83b7\u53d6\u5e7f\u64ad\u53d8\u91cf\u7684\u503c"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:'val sparkConf = new SparkConf().setAppName("Example0212").setMaster("local[*]")\n\n    val sc = new SparkContext(sparkConf)\n\n    val rdd = sc.makeRDD(List(("a", 4), ("b", 1), ("c", 2)))\n\n    val map = mutable.Map(("a",1),("b",2),("c",4))\n\n    val broastMap: Broadcast[mutable.Map[String, Int]] = sc.broadcast(map)\n\n    rdd.map{\n    case (word,count) =>\n        val l =  broastMap.value.getOrElse(word,0)\n        (word,(count,l))\n        }.foreach(println)\n    }\n'})}),"\n",(0,n.jsx)(s.h2,{id:"dataframe\u548cdataset",children:"DataFrame\u548cDataSet"}),"\n",(0,n.jsx)(s.h3,{id:"\u533a\u522b",children:"\u533a\u522b"}),"\n",(0,n.jsx)(s.p,{children:"DataFrame\u548cDataSet\u90fd\u662f\u5206\u5e03\u5f0f\u6570\u636e\u5904\u7406\u7684\u62bd\u8c61\u6982\u5ff5\uff0c\u7528\u4e8e\u8868\u793a\u5206\u5e03\u5f0f\u6570\u636e\u96c6\u3002\u5b83\u4eec\u4e4b\u95f4\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u5176\u5bf9\u7c7b\u578b\u5b89\u5168\u6027\u548c\u7f16\u7a0b\u63a5\u53e3\u7684\u652f\u6301\u3002"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"DataFrame:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"\u6982\u5ff5\uff1a"})," DataFrame \u662f\u4e00\u79cd\u5206\u5e03\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u7531\u547d\u540d\u5217\u7ec4\u6210\u7684\u5206\u5e03\u5f0f\u8868\u683c\u3002\u5b83\u7c7b\u4f3c\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684\u8868\u683c\u6216\u8005Pandas\u5e93\u4e2d\u7684DataFrame\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"\u7c7b\u578b\u5b89\u5168\u6027\uff1a"})," DataFrame \u662f\u4e0d\u7c7b\u578b\u5b89\u5168\u7684\uff0c\u5373\u5b83\u7684\u5217\u6ca1\u6709\u7279\u5b9a\u7684\u7c7b\u578b\u4fe1\u606f\uff0c\u800c\u662f\u88ab\u8ba4\u4e3a\u662f\u901a\u7528\u7684",(0,n.jsx)(s.strong,{children:"Column"}),"\u7c7b\u578b\u3002\u8fd9\u610f\u5473\u7740\u5728\u7f16\u8bd1\u65f6\u65e0\u6cd5\u6355\u6349\u5230\u7c7b\u578b\u9519\u8bef\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"\u7f16\u7a0b\u63a5\u53e3\uff1a"})," DataFrame API \u662f\u57fa\u4e8eSQL\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u7c7b\u4f3c\u4e8eSQL\u7684\u67e5\u8be2\u63a5\u53e3\uff0c\u652f\u6301\u4f7f\u7528SQL\u8bed\u53e5\u8fdb\u884c\u6570\u636e\u64cd\u4f5c\u3002DataFrame\u53ef\u4ee5\u901a\u8fc7Spark SQL\u6a21\u5757\u521b\u5efa\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u5916\u90e8\u6570\u636e\u6e90\u521b\u5efa\u3002"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"DataSet:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"\u6982\u5ff5\uff1a"})," DataSet \u662f\u5f3a\u7c7b\u578b\u7684\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff0c\u5b83\u662f\u5bf9DataFrame\u7684\u6269\u5c55\uff0c\u5f15\u5165\u4e86\u7c7b\u578b\u4fe1\u606f\u3002\u5b83\u53ef\u4ee5\u770b\u4f5c\u662f\u5177\u6709\u7c7b\u578b\u4fe1\u606f\u7684\u5206\u5e03\u5f0f\u96c6\u5408\uff0c\u7c7b\u4f3c\u4e8eScala\u6216Java\u4e2d\u7684\u96c6\u5408\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"\u7c7b\u578b\u5b89\u5168\u6027\uff1a"})," DataSet \u662f\u7c7b\u578b\u5b89\u5168\u7684\uff0c\u5373\u5b83\u5728\u7f16\u8bd1\u65f6\u5c31\u80fd\u6355\u6349\u5230\u7c7b\u578b\u9519\u8bef\u3002\u8fd9\u4f7f\u5f97\u5728\u8fdb\u884c\u64cd\u4f5c\u65f6\u66f4\u5bb9\u6613\u53d1\u73b0\u6f5c\u5728\u7684\u95ee\u9898\u3002"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"\u7f16\u7a0b\u63a5\u53e3\uff1a"})," DataSet API \u63d0\u4f9b\u4e86\u4e00\u7ec4\u5f3a\u7c7b\u578b\u7684\u64cd\u4f5c\u51fd\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7c7b\u548cLambda\u8868\u8fbe\u5f0f\u3002\u5b83\u66f4\u9002\u7528\u4e8e\u7f16\u5199\u590d\u6742\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u7b80\u5355\u7684\u6570\u636e\u64cd\u4f5c\u3002DataSet\u4e5f\u53ef\u4ee5\u901a\u8fc7Spark SQL\u6a21\u5757\u521b\u5efa\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"\u5176\u5b9eDataFrame\u53ef\u4ee5\u770b\u505a\u662f\u7279\u6b8a\u7684DataSet\uff0c\u6570\u636e\u7c7b\u578b\u4e3aRow\uff0c\u770b\u6e90\u7801"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-scala",children:"  type DataFrame = Dataset[Row]\n"})})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},2633:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/img-f11ca5d0830f2dd0a7ca601ee0aaf95c.png"},3529:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/img_1-a6448261ec695375882126e15ff75235.png"},6946:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/img_2-047b69f4eedae791fe236d4818ad5675.png"},7451:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/img_3-fba703bcc6c9fe3c3b9658df6917734a.png"},7540:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/img_4-a98529537c85ee962e4aeb92ea424909.png"},8669:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/img_5-8417767ac41180fa50c1aa035a3c4161.png"},8453:(e,s,r)=>{r.d(s,{R:()=>l,x:()=>t});var n=r(6540);const i={},a=n.createContext(i);function l(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);