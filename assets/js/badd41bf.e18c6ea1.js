"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3661],{1417:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>d,default:()=>_,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var s=n(4848),r=n(8453);const i={},d=void 0,l={id:"Hive/Hive\u7ecf\u5178\u9762\u8bd5SQL",title:"Hive\u7ecf\u5178\u9762\u8bd5SQL",description:"\u9762\u8bd5SQL",source:"@site/docs/Hive/Hive\u7ecf\u5178\u9762\u8bd5SQL.md",sourceDirName:"Hive",slug:"/Hive/Hive\u7ecf\u5178\u9762\u8bd5SQL",permalink:"/docs/Hive/Hive\u7ecf\u5178\u9762\u8bd5SQL",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Hive/Hive\u7ecf\u5178\u9762\u8bd5SQL.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Hive\u5b9e\u8df5",permalink:"/docs/Hive/Hive\u5b9e\u8df5"},next:{title:"hive\u9762\u8bd5\u9898",permalink:"/docs/Hive/hive\u9762\u8bd5\u9898"}},o={},u=[{value:"\u9762\u8bd5SQL",id:"\u9762\u8bd5sql",level:3},{value:"\u8ba1\u7b97\u8fde\u7eed7\u5929\u767b\u5f55\u7528\u6237",id:"\u8ba1\u7b97\u8fde\u7eed7\u5929\u767b\u5f55\u7528\u6237",level:4}];function a(t){const e={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h3,{id:"\u9762\u8bd5sql",children:"\u9762\u8bd5SQL"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://blog.csdn.net/weixin_43161811/article/details/123947852",children:"Hive SQL \u4e94\u5927\u7ecf\u5178\u9762\u8bd5\u9898_hivesql\u9762\u8bd5\u9898"})}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"\u8ba1\u7b97\u8fde\u7eed7\u5929\u767b\u5f55\u7528\u6237",children:"\u8ba1\u7b97\u8fde\u7eed7\u5929\u767b\u5f55\u7528\u6237"}),"\n",(0,s.jsx)(e.p,{children:"\u601d\u8def:"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"1.\u7528\u6237\u6bcf\u5929\u53ef\u80fd\u4e0d\u6b62\u767b\u9646\u4e00\u6b21\uff0c\u5c06\u767b\u5f55\u65e5\u671f\u53bb\u91cd\uff0c\u53d6\u51fa\u5f53\u65e5\u767b\u9646\u6210\u529f\u7684\u65e5\u671f\uff0crow_number()\u51fd\u6570\u5206\u7ec4\u6392\u5e8f\u5e76\u8ba1\u6570\n2.\u65e5\u671f\u51cf\u53bb\u8ba1\u6570\u5f97\u5230\u503c\n3.\u6839\u636e\u6bcf\u4e2a\u7528\u6237count(\u503c)\u5224\u65ad\u8fde\u7eed\u767b\u9646\u5929\u6570\n4.\u6700\u540e\u53d6\u8fde\u7eed\u767b\u9646\u5929\u6570\u5927\u4e8e\u7b49\u4e8e7\u5929\u7684\u7528\u6237"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE db_test.user_log_test(\ndatestr string comment \u2018\u65e5\u671f\u2019,\nuid string comment \u2018\u7528\u6237id\u2019,\nstatus int comment \u2018\u767b\u9646\u72b6\u6001 1:\u6210\u529f 0\uff1a\u5931\u8d25\u2019)\ncomment \u2018\u7528\u6237\u767b\u9646\u65e5\u5fd7\u8868\u2019\nstored as orc;\ninsert into db_test.user_log_test values(\u20182020-08-30\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-30\u2019,\u20181\u2019,0);\ninsert into db_test.user_log_test values(\u20182020-08-29\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-28\u2019,\u20181\u2019,0);\ninsert into db_test.user_log_test values(\u20182020-08-27\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-26\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-25\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-24\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-23\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-22\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-21\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-20\u2019,\u20181\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-25\u2019,\u20182\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-24\u2019,\u20182\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-23\u2019,\u20182\u2019,0);\ninsert into db_test.user_log_test values(\u20182020-08-22\u2019,\u20182\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-21\u2019,\u20182\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-20\u2019,\u20182\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-26\u2019,\u20183\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-25\u2019,\u20183\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-24\u2019,\u20183\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-23\u2019,\u20183\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-22\u2019,\u20183\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-21\u2019,\u20183\u2019,1);\ninsert into db_test.user_log_test values(\u20182020-08-20\u2019,\u20183\u2019,1);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u8ba1\u7b97\u6b65\u9aa4"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u8ba1\u7b97\u51fa\u7528\u6237\u767b\u9646\u6210\u529f\u7684\u65e5\u671f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT  uid\n       ,datestr\nFROM\n(\n\tSELECT  uid\n\t       ,datestr\n\t       ,ROW_NUMBER()over(PARTITION BY uid,datestr ORDER BY  datestr ASC) AS rn\n\tFROM db_test.user_log_test\n\tWHERE status = 1 \n) a\nWHERE rn = 1\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u65e5\u671f\u51cf\u53bb\u8ba1\u6570\u5f97\u5230\u503c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT  uid\n       ,date_sub(datestr,num) date_rn\nFROM\n(\n\tSELECT  uid\n\t       ,datestr\n\t       ,ROW_NUMBER() over(PARTITION BY uid ORDER BY  datestr) AS num\n\tFROM\n\t(\n\t\tSELECT  uid\n\t\t       ,datestr\n\t\t       ,ROW_NUMBER()over(PARTITION BY uid,datestr ORDER BY  datestr ASC) AS rn\n\t\tFROM db_test.user_log_test\n\t\tWHERE status = 1 \n\t) a\n\tWHERE rn = 1 \n) b\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u6839\u636e\u6bcf\u4e2a\u7528\u6237count(\u503c)\u5224\u65ad\u8fde\u7eed\u767b\u9646\u5929\u6570"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"select uid,     \n     ,COUNT(*) cnt\u2013\u8fde\u7eed\u767b\u9646\u5929\u6570\nFROM\n(\n\tSELECT  uid\n\t       ,date_sub(datestr,num) date_rn\n\tFROM\n\t(\n\t\tSELECT  uid\n\t\t       ,datestr\n\t\t       ,ROW_NUMBER() over(PARTITION BY uid ORDER BY  datestr) AS num\n\t\tFROM\n\t\t(\n\t\t\tSELECT  uid\n\t\t\t       ,datestr\n\t\t\t       ,ROW_NUMBER()over(PARTITION BY uid,datestr ORDER BY  datestr ASC) AS rn\n\t\t\tFROM db_test.user_log_test\n\t\t\tWHERE status = 1 \n\t\t) a\n\t\tWHERE rn = 1 \n\t) b\n)c\nGROUP BY  uid\n         ,date_rn\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u6700\u540e\u53d6\u8fde\u7eed\u767b\u9646\u5929\u6570\u5927\u4e8e\u7b49\u4e8e7\u5929\u7684\u7528\u6237"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT  uid\nFROM\n(\n\tSELECT  uid\n\t       ,date_sub(datestr,num) date_rn\n\tFROM\n\t(\n\t\tSELECT  uid\n\t\t       ,datestr\n\t\t       ,ROW_NUMBER() over(PARTITION BY uid ORDER BY  datestr) AS num\n\t\tFROM\n\t\t(\n\t\t\tSELECT  uid\n\t\t\t       ,datestr\n\t\t\t       ,ROW_NUMBER()over(PARTITION BY uid,datestr ORDER BY  datestr ASC) AS rn\n\t\t\tFROM db_test.user_log_test\n\t\t\tWHERE status = 1 \n\t\t) a\n\t\tWHERE rn = 1 \n\t) b\n)c\nGROUP BY  uid\n         ,date_rn\nHAVING COUNT(1) >= 7\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u901a\u8fc7\u7a97\u53e3\u51fd\u6570\u89e3\u51b3"})}),"\n"]}),"\n"]})]})}function _(t={}){const{wrapper:e}={...(0,r.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(a,{...t})}):a(t)}},8453:(t,e,n)=>{n.d(e,{R:()=>d,x:()=>l});var s=n(6540);const r={},i=s.createContext(r);function d(t){const e=s.useContext(i);return s.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function l(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:d(t.components),s.createElement(i.Provider,{value:e},t.children)}}}]);